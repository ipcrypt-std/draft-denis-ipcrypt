<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Methods for IP Address Encryption and Obfuscation</title>
<meta content="Frank Denis" name="author">
<meta content="
       IP addresses are personally identifiable information that requires protection, yet common techniques such as truncation destroy data irreversibly while providing inconsistent privacy guarantees, and ad-hoc encryption schemes often lack interoperability and security analysis. 
       This document specifies secure, efficient methods for encrypting IP addresses for privacy-preserving storage, logging, and analytics, addressing data minimization concerns raised in  . 
       Four concrete instantiations are defined:  ipcrypt-deterministic  provides deterministic, format-preserving encryption with 16-byte outputs;  ipcrypt-pfx  provides deterministic, prefix-preserving encryption that maintains network relationships with native address sizes (4 bytes for IPv4, 16 bytes for IPv6); while  ipcrypt-nd  and  ipcrypt-ndx  introduce randomness to prevent correlation. All methods are reversible with the encryption key and designed for high-performance processing at network speeds. 
    " name="description">
<meta content="xml2rfc 3.30.1" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-denis-ipcrypt-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.30.1
    Python 3.12.11
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.6
    lxml 5.3.1
    platformdirs 4.4.0
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.5
    setuptools 80.9.0
    wcwidth 0.2.13
-->
<link href="draft-denis-ipcrypt.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">ipcrypt</td>
<td class="right">September 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Denis</td>
<td class="center">Expires 15 March 2026</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-denis-ipcrypt-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-09-11" class="published">11 September 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2026-03-15">15 March 2026</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">F. Denis</div>
<div class="org">Fastly Inc.</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Methods for IP Address Encryption and Obfuscation</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">IP addresses are personally identifiable information that requires protection, yet common techniques such as truncation destroy data irreversibly while providing inconsistent privacy guarantees, and ad-hoc encryption schemes often lack interoperability and security analysis.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2">This document specifies secure, efficient methods for encrypting IP addresses for privacy-preserving storage, logging, and analytics, addressing data minimization concerns raised in <span>[<a href="#RFC6973" class="cite xref">RFC6973</a>]</span>.<a href="#section-abstract-2" class="pilcrow">¶</a></p>
<p id="section-abstract-3">Four concrete instantiations are defined: <code>ipcrypt-deterministic</code> provides deterministic, format-preserving encryption with 16-byte outputs; <code>ipcrypt-pfx</code> provides deterministic, prefix-preserving encryption that maintains network relationships with native address sizes (4 bytes for IPv4, 16 bytes for IPv6); while <code>ipcrypt-nd</code> and <code>ipcrypt-ndx</code> introduce randomness to prevent correlation. All methods are reversible with the encryption key and designed for high-performance processing at network speeds.<a href="#section-abstract-3" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Source for this draft and an issue tracker can be found at
    <span><a href="https://github.com/jedisct1/draft-denis-ipcrypt">https://github.com/jedisct1/draft-denis-ipcrypt</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 15 March 2026.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-use-cases-and-motivations" class="internal xref">Use Cases and Motivations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-relationship-to-ietf-work" class="internal xref">Relationship to IETF Work</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-ip-address-conversion" class="internal xref">IP Address Conversion</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-converting-to-a-16-byte-rep" class="internal xref">Converting to a 16-Byte Representation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1"><a href="#section-3.1.1" class="auto internal xref">3.1.1</a>.  <a href="#name-ipv6-addresses" class="internal xref">IPv6 Addresses</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.2">
                    <p id="section-toc.1-1.3.2.1.2.2.1"><a href="#section-3.1.2" class="auto internal xref">3.1.2</a>.  <a href="#name-ipv4-addresses" class="internal xref">IPv4 Addresses</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-converting-from-a-16-byte-r" class="internal xref">Converting from a 16-Byte Representation to an IP Address</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-generic-constructions" class="internal xref">Generic Constructions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-deterministic-encryption" class="internal xref">Deterministic Encryption</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-ipcrypt-deterministic" class="internal xref">ipcrypt-deterministic</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-format-preservation-and-lim" class="internal xref">Format Preservation and Limitations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.1">
                    <p id="section-toc.1-1.5.2.2.2.1.1"><a href="#section-5.2.1" class="auto internal xref">5.2.1</a>.  <a href="#name-network-hierarchy-preservat" class="internal xref">Network Hierarchy Preservation</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.2">
                    <p id="section-toc.1-1.5.2.2.2.2.1"><a href="#section-5.2.2" class="auto internal xref">5.2.2</a>.  <a href="#name-format-preservation-without" class="internal xref">Format Preservation Without Prefix Preservation</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.3">
                    <p id="section-toc.1-1.5.2.2.2.3.1"><a href="#section-5.2.3" class="auto internal xref">5.2.3</a>.  <a href="#name-preserving-metadata-for-ana" class="internal xref">Preserving Metadata for Analytics</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-prefix-preserving-encryptio" class="internal xref">Prefix-Preserving Encryption</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-prefix-preserving-construct" class="internal xref">Prefix-Preserving Construction</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-concrete-instantiation-ipcr" class="internal xref">Concrete Instantiation: ipcrypt-pfx</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.1">
                    <p id="section-toc.1-1.6.2.2.2.1.1"><a href="#section-6.2.1" class="auto internal xref">6.2.1</a>.  <a href="#name-pseudorandom-function-const" class="internal xref">Pseudorandom Function Construction</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.2">
                    <p id="section-toc.1-1.6.2.2.2.2.1"><a href="#section-6.2.2" class="auto internal xref">6.2.2</a>.  <a href="#name-bit-encryption-process" class="internal xref">Bit Encryption Process</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.3">
                    <p id="section-toc.1-1.6.2.2.2.3.1"><a href="#section-6.2.3" class="auto internal xref">6.2.3</a>.  <a href="#name-key-requirements" class="internal xref">Key Requirements</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.4">
                    <p id="section-toc.1-1.6.2.2.2.4.1"><a href="#section-6.2.4" class="auto internal xref">6.2.4</a>.  <a href="#name-security-properties" class="internal xref">Security Properties</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.5">
                    <p id="section-toc.1-1.6.2.2.2.5.1"><a href="#section-6.2.5" class="auto internal xref">6.2.5</a>.  <a href="#name-implementation-consideratio" class="internal xref">Implementation Considerations</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-non-deterministic-encryptio" class="internal xref">Non-Deterministic Encryption</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-encryption-process" class="internal xref">Encryption Process</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-decryption-process" class="internal xref">Decryption Process</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-output-format-and-encoding" class="internal xref">Output Format and Encoding</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="auto internal xref">7.4</a>.  <a href="#name-concrete-instantiations" class="internal xref">Concrete Instantiations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4.2.1">
                    <p id="section-toc.1-1.7.2.4.2.1.1"><a href="#section-7.4.1" class="auto internal xref">7.4.1</a>.  <a href="#name-ipcrypt-nd-kiasu-bc" class="internal xref">ipcrypt-nd (KIASU-BC)</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4.2.2">
                    <p id="section-toc.1-1.7.2.4.2.2.1"><a href="#section-7.4.2" class="auto internal xref">7.4.2</a>.  <a href="#name-ipcrypt-ndx-aes-xts" class="internal xref">ipcrypt-ndx (AES-XTS)</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4.2.3">
                    <p id="section-toc.1-1.7.2.4.2.3.1"><a href="#section-7.4.3" class="auto internal xref">7.4.3</a>.  <a href="#name-comparison-of-modes" class="internal xref">Comparison of Modes</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.5">
                <p id="section-toc.1-1.7.2.5.1"><a href="#section-7.5" class="auto internal xref">7.5</a>.  <a href="#name-alternatives-to-random-twea" class="internal xref">Alternatives to Random Tweaks</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-deterministic-mode-security" class="internal xref">Deterministic Mode Security</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-non-deterministic-mode-secu" class="internal xref">Non-Deterministic Mode Security</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="auto internal xref">8.3</a>.  <a href="#name-implementation-security" class="internal xref">Implementation Security</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="auto internal xref">8.4</a>.  <a href="#name-key-management-consideratio" class="internal xref">Key Management Considerations</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-implementation-details" class="internal xref">Implementation Details</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-visual-diagrams" class="internal xref">Visual Diagrams</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.1">
                    <p id="section-toc.1-1.9.2.1.2.1.1"><a href="#section-9.1.1" class="auto internal xref">9.1.1</a>.  <a href="#name-ipv4-address-conversion-dia" class="internal xref">IPv4 Address Conversion Diagram</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.2">
                    <p id="section-toc.1-1.9.2.1.2.2.1"><a href="#section-9.1.2" class="auto internal xref">9.1.2</a>.  <a href="#name-deterministic-encryption-fl" class="internal xref">Deterministic Encryption Flow</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.3">
                    <p id="section-toc.1-1.9.2.1.2.3.1"><a href="#section-9.1.3" class="auto internal xref">9.1.3</a>.  <a href="#name-prefix-preserving-encryption" class="internal xref">Prefix-Preserving Encryption Flow (ipcrypt-pfx)</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.4">
                    <p id="section-toc.1-1.9.2.1.2.4.1"><a href="#section-9.1.4" class="auto internal xref">9.1.4</a>.  <a href="#name-non-deterministic-encryption" class="internal xref">Non-Deterministic Encryption Flow (ipcrypt-nd)</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.5">
                    <p id="section-toc.1-1.9.2.1.2.5.1"><a href="#section-9.1.5" class="auto internal xref">9.1.5</a>.  <a href="#name-non-deterministic-encryption-" class="internal xref">Non-Deterministic Encryption Flow (ipcrypt-ndx)</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-ipv4-address-conversion" class="internal xref">IPv4 Address Conversion</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="auto internal xref">9.3</a>.  <a href="#name-ipv6-address-conversion" class="internal xref">IPv6 Address Conversion</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4">
                <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="auto internal xref">9.4</a>.  <a href="#name-conversion-from-a-16-byte-a" class="internal xref">Conversion from a 16-Byte Array to an IP Address String</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.5">
                <p id="section-toc.1-1.9.2.5.1"><a href="#section-9.5" class="auto internal xref">9.5</a>.  <a href="#name-deterministic-encryption-ip" class="internal xref">Deterministic Encryption (ipcrypt-deterministic)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.5.2.1">
                    <p id="section-toc.1-1.9.2.5.2.1.1"><a href="#section-9.5.1" class="auto internal xref">9.5.1</a>.  <a href="#name-encryption" class="internal xref">Encryption</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.5.2.2">
                    <p id="section-toc.1-1.9.2.5.2.2.1"><a href="#section-9.5.2" class="auto internal xref">9.5.2</a>.  <a href="#name-decryption" class="internal xref">Decryption</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.6">
                <p id="section-toc.1-1.9.2.6.1"><a href="#section-9.6" class="auto internal xref">9.6</a>.  <a href="#name-prefix-preserving-encryption-" class="internal xref">Prefix-Preserving Encryption (ipcrypt-pfx)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.6.2.1">
                    <p id="section-toc.1-1.9.2.6.2.1.1"><a href="#section-9.6.1" class="auto internal xref">9.6.1</a>.  <a href="#name-encryption-2" class="internal xref">Encryption</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.6.2.2">
                    <p id="section-toc.1-1.9.2.6.2.2.1"><a href="#section-9.6.2" class="auto internal xref">9.6.2</a>.  <a href="#name-decryption-2" class="internal xref">Decryption</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.6.2.3">
                    <p id="section-toc.1-1.9.2.6.2.3.1"><a href="#section-9.6.3" class="auto internal xref">9.6.3</a>.  <a href="#name-helper-functions" class="internal xref">Helper Functions</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.7">
                <p id="section-toc.1-1.9.2.7.1"><a href="#section-9.7" class="auto internal xref">9.7</a>.  <a href="#name-non-deterministic-encryption-u" class="internal xref">Non-Deterministic Encryption using KIASU-BC (ipcrypt-nd)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.7.2.1">
                    <p id="section-toc.1-1.9.2.7.2.1.1"><a href="#section-9.7.1" class="auto internal xref">9.7.1</a>.  <a href="#name-encryption-3" class="internal xref">Encryption</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.7.2.2">
                    <p id="section-toc.1-1.9.2.7.2.2.1"><a href="#section-9.7.2" class="auto internal xref">9.7.2</a>.  <a href="#name-decryption-3" class="internal xref">Decryption</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.8">
                <p id="section-toc.1-1.9.2.8.1"><a href="#section-9.8" class="auto internal xref">9.8</a>.  <a href="#name-non-deterministic-encryption-us" class="internal xref">Non-Deterministic Encryption using AES-XTS (ipcrypt-ndx)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.8.2.1">
                    <p id="section-toc.1-1.9.2.8.2.1.1"><a href="#section-9.8.1" class="auto internal xref">9.8.1</a>.  <a href="#name-encryption-4" class="internal xref">Encryption</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.8.2.2">
                    <p id="section-toc.1-1.9.2.8.2.2.1"><a href="#section-9.8.2" class="auto internal xref">9.8.2</a>.  <a href="#name-decryption-4" class="internal xref">Decryption</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.8.2.3">
                    <p id="section-toc.1-1.9.2.8.2.3.1"><a href="#section-9.8.3" class="auto internal xref">9.8.3</a>.  <a href="#name-helper-functions-for-aes-xt" class="internal xref">Helper Functions for AES-XTS</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.9">
                <p id="section-toc.1-1.9.2.9.1"><a href="#section-9.9" class="auto internal xref">9.9</a>.  <a href="#name-kiasu-bc-implementation-gui" class="internal xref">KIASU-BC Implementation Guide</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.9.2.1">
                    <p id="section-toc.1-1.9.2.9.2.1.1"><a href="#section-9.9.1" class="auto internal xref">9.9.1</a>.  <a href="#name-overview" class="internal xref">Overview</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.9.2.2">
                    <p id="section-toc.1-1.9.2.9.2.2.1"><a href="#section-9.9.2" class="auto internal xref">9.9.2</a>.  <a href="#name-tweak-padding" class="internal xref">Tweak Padding</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.9.2.3">
                    <p id="section-toc.1-1.9.2.9.2.3.1"><a href="#section-9.9.3" class="auto internal xref">9.9.3</a>.  <a href="#name-round-structure" class="internal xref">Round Structure</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.9.2.4">
                    <p id="section-toc.1-1.9.2.9.2.4.1"><a href="#section-9.9.4" class="auto internal xref">9.9.4</a>.  <a href="#name-key-schedule" class="internal xref">Key Schedule</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.9.2.5">
                    <p id="section-toc.1-1.9.2.9.2.5.1"><a href="#section-9.9.5" class="auto internal xref">9.9.5</a>.  <a href="#name-implementation-steps" class="internal xref">Implementation Steps</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.9.2.6">
                    <p id="section-toc.1-1.9.2.9.2.6.1"><a href="#section-9.9.6" class="auto internal xref">9.9.6</a>.  <a href="#name-example-implementation" class="internal xref">Example Implementation</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-implementation-status" class="internal xref">Implementation Status</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-licensing" class="internal xref">Licensing</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="auto internal xref">12</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-12.1" class="auto internal xref">12.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#section-12.2" class="auto internal xref">12.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-test-vectors" class="internal xref">Test Vectors</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#appendix-A.1" class="auto internal xref">A.1</a>.  <a href="#name-ipcrypt-deterministic-test-" class="internal xref">ipcrypt-deterministic Test Vectors</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#appendix-A.2" class="auto internal xref">A.2</a>.  <a href="#name-ipcrypt-pfx-test-vectors" class="internal xref">ipcrypt-pfx Test Vectors</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2.2.1">
                    <p id="section-toc.1-1.13.2.2.2.1.1"><a href="#appendix-A.2.1" class="auto internal xref">A.2.1</a>.  <a href="#name-basic-test-vectors" class="internal xref">Basic Test Vectors</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2.2.2">
                    <p id="section-toc.1-1.13.2.2.2.2.1"><a href="#appendix-A.2.2" class="auto internal xref">A.2.2</a>.  <a href="#name-prefix-preserving-test-vect" class="internal xref">Prefix-Preserving Test Vectors</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.3">
                <p id="section-toc.1-1.13.2.3.1"><a href="#appendix-A.3" class="auto internal xref">A.3</a>.  <a href="#name-ipcrypt-nd-test-vectors" class="internal xref">ipcrypt-nd Test Vectors</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.4">
                <p id="section-toc.1-1.13.2.4.1"><a href="#appendix-A.4" class="auto internal xref">A.4</a>.  <a href="#name-ipcrypt-ndx-test-vectors" class="internal xref">ipcrypt-ndx Test Vectors</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#appendix-D" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">IP addresses are personally identifiable information requiring protection, yet common anonymization approaches have fundamental limitations. Truncation (zeroing parts of addresses) irreversibly destroys data while providing variable privacy levels; a /24 mask may obscure one user or thousands depending on network allocation. Hashing produces non-reversible outputs unsuitable for operational tasks such as abuse investigation. Ad-hoc encryption schemes often lack rigorous security analysis and have limited interoperability.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">This document addresses these deficiencies by specifying secure, efficient, and interoperable methods for IP address encryption and obfuscation.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">This specification addresses concerns raised in <span>[<a href="#RFC7624" class="cite xref">RFC7624</a>]</span> regarding confidentiality when sharing data with third parties. Unlike existing practices that obscure addresses, these methods provide mathematically provable security properties, which are discussed throughout this document and summarized in <a href="#security-considerations" class="auto internal xref">Section 8</a>.<a href="#section-1-3" class="pilcrow">¶</a></p>
<div id="use-cases-and-motivations">
<section id="section-1.1">
        <h3 id="name-use-cases-and-motivations">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-use-cases-and-motivations" class="section-name selfRef">Use Cases and Motivations</a>
        </h3>
<p id="section-1.1-1">Organizations handling IP addresses require mechanisms to protect user privacy while maintaining operational capabilities. Generic encryption systems expand data unpredictably, lack compatibility with network tools, and are not designed for high-volume processing. The specialized methods in this specification address these requirements:<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-2.1">
            <p id="section-1.1-2.1.1">Efficiency and Compactness: All variants operate on 128 bits, achieving single-block encryption speed required for network-rate processing. Non-deterministic variants add only 8-16 bytes of tweak overhead.<a href="#section-1.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-2.2">
            <p id="section-1.1-2.2.1">High Usage Limits: Non-deterministic variants safely handle massive volumes: approximately 4 billion operations for <code>ipcrypt-nd</code> and 18 quintillion for <code>ipcrypt-ndx</code> per key, without degrading security. Generic encryption often requires complex key rotation schemes at lower thresholds.<a href="#section-1.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-2.3">
            <p id="section-1.1-2.3.1">Format Preservation: The <code>ipcrypt-deterministic</code> and <code>ipcrypt-pfx</code> variants produce valid IP addresses rather than arbitrary ciphertext, enabling encrypted addresses to pass through existing network infrastructure, monitoring tools, and databases without modification. The <code>ipcrypt-pfx</code> variant uniquely preserves network prefix relationships while maintaining the original address type and size, enabling network-level analytics while protecting individual address identity (see <a href="#format-preservation-and-limitations" class="auto internal xref">Section 5.2</a>).<a href="#section-1.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-2.4">
            <p id="section-1.1-2.4.1">Interoperability: All conforming implementations produce identical results, enabling data exchange between different systems, vendors, and programming languages.<a href="#section-1.1-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-3">These specialized encryption methods enable several use cases:<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-4.1">
            <p id="section-1.1-4.1.1">Privacy Protection: Prevents exposure of sensitive user information to third parties in logs, analytics data, and network measurements (<span>[<a href="#RFC6973" class="cite xref">RFC6973</a>]</span>). The key holder retains decryption capability.<a href="#section-1.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.2">
            <p id="section-1.1-4.2.1">Correlation Attack Resistance: Non-deterministic variants leverage random tweaks to hide patterns and enhance confidentiality (see <a href="#non-deterministic-encryption" class="auto internal xref">Section 7</a>).<a href="#section-1.1-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.3">
            <p id="section-1.1-4.3.1">Privacy-Preserving Analytics: Encrypted IP addresses can be used directly for counting unique clients, rate limiting, or deduplication without revealing original values. This addresses the anonymization requirements for DNS query data sharing outlined in <span>[<a href="#RSSAC040" class="cite xref">RSSAC040</a>]</span>. The <code>ipcrypt-pfx</code> variant preserves network prefixes for network-level analytics, while other methods scramble network hierarchy.<a href="#section-1.1-4.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.4">
            <p id="section-1.1-4.4.1">Third-Party Integration: Encrypted IP addresses can serve as privacy-preserving identifiers when interacting with untrusted services, cloud providers, or external platforms.<a href="#section-1.1-4.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-5">The following examples demonstrate how the same IP addresses transform under each method:<a href="#section-1.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-6.1">
            <p id="section-1.1-6.1.1">Format-preserving: Valid IP addresses, same input always produces same output:<a href="#section-1.1-6.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<div class="alignLeft art-text artwork" id="section-1.1-7">
<pre>
192.168.1.1   -&gt; d1e9:518:d5bc:4487:51c6:c51f:44ed:e9f6
192.168.1.254 -&gt; fd7e:f70f:44d7:cdb2:2992:95a1:e692:7696
192.168.1.254 -&gt; fd7e:f70f:44d7:cdb2:2992:95a1:e692:7696  # Same output
</pre><a href="#section-1.1-7" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-1.1-8.1">
            <p id="section-1.1-8.1.1">Prefix-preserving: Maintains network structure, same prefix when IPs share prefix:<a href="#section-1.1-8.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<div class="alignLeft art-text artwork" id="section-1.1-9">
<pre>
192.168.1.1   -&gt; 251.81.131.124
192.168.1.254 -&gt; 251.81.131.159       # Prefix is preserved
172.16.69.42  -&gt; 165.228.146.177
</pre><a href="#section-1.1-9" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-1.1-10.1">
            <p id="section-1.1-10.1.1">Non-deterministic: Larger output, different each time:<a href="#section-1.1-10.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<div class="alignLeft art-text artwork" id="section-1.1-11">
<pre>
192.168.1.1   -&gt; f0ea0bbd...03aa9fcb
192.168.1.254 -&gt; 620b58d8...2ff8086f
192.168.1.254 -&gt; 35fc2338...25abed5d  # Same input, different outputs
</pre><a href="#section-1.1-11" class="pilcrow">¶</a>
</div>
<p id="section-1.1-12">For implementation guidelines, see <a href="#implementation-details" class="auto internal xref">Section 9</a>.<a href="#section-1.1-12" class="pilcrow">¶</a></p>
</section>
</div>
<div id="relationship-to-ietf-work">
<section id="section-1.2">
        <h3 id="name-relationship-to-ietf-work">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-relationship-to-ietf-work" class="section-name selfRef">Relationship to IETF Work</a>
        </h3>
<p id="section-1.2-1"><em>This section is to be removed before publishing as an RFC.</em><a href="#section-1.2-1" class="pilcrow">¶</a></p>
<p id="section-1.2-2">This document does not conflict with active IETF working group efforts. While the IETF has produced several RFCs related to privacy (<span>[<a href="#RFC6973" class="cite xref">RFC6973</a>]</span>, <span>[<a href="#RFC7258" class="cite xref">RFC7258</a>]</span>, <span>[<a href="#RFC7624" class="cite xref">RFC7624</a>]</span>), there is no current standardization effort for IP address encryption methods. This specification complements existing IETF privacy guidance by providing implementation methods.<a href="#section-1.2-2" class="pilcrow">¶</a></p>
<p id="section-1.2-3">The cryptographic primitives used (AES, format-preserving encryption) align with IETF cryptographic recommendations, and the document follows IETF formatting and terminology conventions where applicable.<a href="#section-1.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="terminology">
<section id="section-2">
      <h2 id="name-terminology">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
      </h2>
<p id="section-2-1">The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in BCP 14 <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">Throughout this document, the following terms and conventions apply:<a href="#section-2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-3.1">
          <p id="section-2-3.1.1">IP Address: An IPv4 or IPv6 address as defined in <span>[<a href="#RFC4291" class="cite xref">RFC4291</a>]</span>.<a href="#section-2-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.2">
          <p id="section-2-3.2.1">IPv4-mapped IPv6 Address: An IPv6 address format (::ffff:a.b.c.d) used to represent IPv4 addresses within the IPv6 address space, enabling uniform processing of both address types.<a href="#section-2-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.3">
          <p id="section-2-3.3.1">16-Byte Representation: A fixed-length representation used for both IPv4 (via IPv4-mapped IPv6) and IPv6 addresses.<a href="#section-2-3.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.4">
          <p id="section-2-3.4.1">Block Cipher: A deterministic cryptographic algorithm that encrypts fixed-size blocks of data (128 bits in this specification) using a secret key.<a href="#section-2-3.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.5">
          <p id="section-2-3.5.1">Permutation: A bijective function where each distinct input maps to a unique output, ensuring reversibility.<a href="#section-2-3.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.6">
          <p id="section-2-3.6.1">Pseudorandom Function (PRF): A deterministic function that produces output computationally indistinguishable from truly random values.<a href="#section-2-3.6.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.7">
          <p id="section-2-3.7.1">Tweakable Block Cipher (TBC): A block cipher that accepts an additional non-secret parameter (tweak) along with the key and plaintext, allowing domain separation without changing keys.<a href="#section-2-3.7.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.8">
          <p id="section-2-3.8.1">Tweak: A non-secret, additional input to a tweakable block cipher that further randomizes the output.<a href="#section-2-3.8.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.9">
          <p id="section-2-3.9.1">Deterministic Encryption: Encryption that always produces the same ciphertext for a given input and key.<a href="#section-2-3.9.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.10">
          <p id="section-2-3.10.1">Non-Deterministic Encryption: Encryption that produces different ciphertexts for the same input due to the inclusion of a randomly sampled tweak.<a href="#section-2-3.10.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.11">
          <p id="section-2-3.11.1">Prefix-Preserving Encryption: An encryption mode where IP addresses from the same network produce ciphertexts that share a common encrypted prefix, maintaining network relationships while obscuring actual network identities.<a href="#section-2-3.11.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.12">
          <p id="section-2-3.12.1">Birthday Bound: The point at which collisions become statistically likely in a random sampling process, approximately 2<sup>(n/2)</sup> operations for n-bit values.<a href="#section-2-3.12.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.13">
          <p id="section-2-3.13.1">(Input, Tweak) Collision: A scenario where the same input is encrypted with the same tweak. This reveals that the input was repeated but not the input’s value.<a href="#section-2-3.13.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="ip-address-conversion">
<section id="section-3">
      <h2 id="name-ip-address-conversion">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-ip-address-conversion" class="section-name selfRef">IP Address Conversion</a>
      </h2>
<p id="section-3-1">This section describes the conversion of IP addresses to and from a 16-byte representation used by <code>ipcrypt-deterministic</code>, <code>ipcrypt-nd</code>, and <code>ipcrypt-ndx</code>. The <code>ipcrypt-pfx</code> method differs by maintaining native address sizes—4 bytes for IPv4 and 16 bytes for IPv6—to preserve network structure (see <a href="#prefix-preserving-encryption" class="auto internal xref">Section 6</a>).<a href="#section-3-1" class="pilcrow">¶</a></p>
<div id="converting-to-a-16-byte-representation">
<section id="section-3.1">
        <h3 id="name-converting-to-a-16-byte-rep">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-converting-to-a-16-byte-rep" class="section-name selfRef">Converting to a 16-Byte Representation</a>
        </h3>
<div id="ipv6-addresses">
<section id="section-3.1.1">
          <h4 id="name-ipv6-addresses">
<a href="#section-3.1.1" class="section-number selfRef">3.1.1. </a><a href="#name-ipv6-addresses" class="section-name selfRef">IPv6 Addresses</a>
          </h4>
<p id="section-3.1.1-1">IPv6 addresses (128 bits) are converted directly using network byte order as specified in <span>[<a href="#RFC4291" class="cite xref">RFC4291</a>]</span>.<a href="#section-3.1.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1.1-2"><em>Example:</em><a href="#section-3.1.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1.1-3">
<pre>
IPv6 Address:           2001:0db8:85a3:0000:0000:8a2e:0370:7334
16-Byte Representation: [20 01 0d b8 85 a3 00 00 00 00 8a 2e 03 70 73 34]
</pre><a href="#section-3.1.1-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="ipv4-addresses">
<section id="section-3.1.2">
          <h4 id="name-ipv4-addresses">
<a href="#section-3.1.2" class="section-number selfRef">3.1.2. </a><a href="#name-ipv4-addresses" class="section-name selfRef">IPv4 Addresses</a>
          </h4>
<p id="section-3.1.2-1">IPv4 addresses (32 bits) are mapped using the IPv4-mapped IPv6 format as specified in <span>[<a href="#RFC4291" class="cite xref">RFC4291</a>]</span>:<a href="#section-3.1.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1.2-2">
<pre>
IPv4 Address:           192.0.2.1
16-Byte Representation: [00 00 00 00 00 00 00 00 00 00 FF FF C0 00 02 01]
</pre><a href="#section-3.1.2-2" class="pilcrow">¶</a>
</div>
<p id="section-3.1.2-3">Note on representation equivalence: For all <code>ipcrypt</code> variants, encrypting an IPv4 address and encrypting its IPv4-mapped IPv6 form (<code>::FFFF:a.b.c.d</code>) produce the same encrypted output.<a href="#section-3.1.2-3" class="pilcrow">¶</a></p>
<p id="section-3.1.2-4">This behavior is intentional: in the intended use cases, IP addresses function as identifiers, and producing a single encrypted identifier for the same endpoint across representations avoids ambiguity.<a href="#section-3.1.2-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="converting-from-a-16-byte-representation-to-an-ip-address">
<section id="section-3.2">
        <h3 id="name-converting-from-a-16-byte-r">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-converting-from-a-16-byte-r" class="section-name selfRef">Converting from a 16-Byte Representation to an IP Address</a>
        </h3>
<p id="section-3.2-1">Conversion algorithm:<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.2-2">
<li id="section-3.2-2.1">
            <p id="section-3.2-2.1.1">Examine the first 12 bytes of the 16-byte representation<a href="#section-3.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.2-2.2">
            <p id="section-3.2-2.2.1">If they match the IPv4-mapped prefix (10 bytes of 0x00 followed by 0xFF, 0xFF):<a href="#section-3.2-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-2.2.2.1">
                <p id="section-3.2-2.2.2.1.1">Interpret the last 4 bytes as an IPv4 address in dotted-decimal notation<a href="#section-3.2-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li id="section-3.2-2.3">
            <p id="section-3.2-2.3.1">Otherwise:<a href="#section-3.2-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-2.3.2.1">
                <p id="section-3.2-2.3.2.1.1">Interpret the 16 bytes as an IPv6 address in colon-hexadecimal notation<a href="#section-3.2-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ol>
</section>
</div>
</section>
</div>
<div id="generic-constructions">
<section id="section-4">
      <h2 id="name-generic-constructions">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-generic-constructions" class="section-name selfRef">Generic Constructions</a>
      </h2>
<p id="section-4-1">This specification defines two generic cryptographic constructions:<a href="#section-4-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4-2">
<li id="section-4-2.1">
          <p id="section-4-2.1.1">128-bit Block Cipher Construction:<a href="#section-4-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.1.2.1">
              <p id="section-4-2.1.2.1.1">Used in deterministic encryption (see <a href="#deterministic-encryption" class="auto internal xref">Section 5</a>)<a href="#section-4-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.1.2.2">
              <p id="section-4-2.1.2.2.1">Operates on a single 16-byte block<a href="#section-4-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.1.2.3">
              <p id="section-4-2.1.2.3.1">Example: AES-128 treated as a permutation<a href="#section-4-2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
        <li id="section-4-2.2">
          <p id="section-4-2.2.1">128-bit Tweakable Block Cipher (TBC) Construction:<a href="#section-4-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.2.2.1">
              <p id="section-4-2.2.2.1.1">Used in non-deterministic encryption (see <a href="#non-deterministic-encryption" class="auto internal xref">Section 7</a>)<a href="#section-4-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.2.2.2">
              <p id="section-4-2.2.2.2.1">Accepts a key, a tweak, and a message<a href="#section-4-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.2.2.3">
              <p id="section-4-2.2.2.3.1">The tweak must be uniformly random when generated<a href="#section-4-2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.2.2.4">
              <p id="section-4-2.2.2.4.1">Reuse of the same tweak on different inputs does not compromise confidentiality<a href="#section-4-2.2.2.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
      </ol>
<p id="section-4-3">Valid options for implementing a tweakable block cipher include, but are not limited to:<a href="#section-4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-4.1">
          <p id="section-4-4.1.1">SKINNY (see <span>[<a href="#SKINNY" class="cite xref">SKINNY</a>]</span>)<a href="#section-4-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-4.2">
          <p id="section-4-4.2.1">DEOXYS-BC (see <span>[<a href="#DEOXYS-BC" class="cite xref">DEOXYS-BC</a>]</span>)<a href="#section-4-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-4.3">
          <p id="section-4-4.3.1">KIASU-BC (see <a href="#implementing-kiasu-bc" class="auto internal xref">Section 9.9</a> for implementation details)<a href="#section-4-4.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-4.4">
          <p id="section-4-4.4.1">AES-XTS (see <a href="#ipcrypt-ndx" class="auto internal xref">Section 7.4.2</a> for usage)<a href="#section-4-4.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-4-5">Implementers MUST choose a cipher that provides robust resistance against related-tweak and other cryptographic attacks.<a href="#section-4-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="deterministic-encryption">
<section id="section-5">
      <h2 id="name-deterministic-encryption">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-deterministic-encryption" class="section-name selfRef">Deterministic Encryption</a>
      </h2>
<p id="section-5-1">Deterministic encryption applies a 128-bit block cipher directly to the 16-byte representation of an IP address, producing the same ciphertext for the same input and key.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">Deterministic encryption is appropriate when:<a href="#section-5-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-3.1">
          <p id="section-5-3.1.1">Duplicate IP addresses need to be detected in encrypted form (e.g., for rate limiting)<a href="#section-5-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-3.2">
          <p id="section-5-3.2.1">Storage space is critical (produces only 16 bytes output)<a href="#section-5-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-3.3">
          <p id="section-5-3.3.1">Format preservation is required (output remains a valid IP address)<a href="#section-5-3.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-3.4">
          <p id="section-5-3.4.1">Correlation of the same address across records is acceptable<a href="#section-5-3.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-5-4">All instantiations (<code>ipcrypt-deterministic</code>, <code>ipcrypt-pfx</code>, <code>ipcrypt-nd</code>, and <code>ipcrypt-ndx</code>) are invertible. For non-deterministic modes, the tweak must be preserved along with the ciphertext to enable decryption.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">Implementation details are provided in <a href="#implementation-details" class="auto internal xref">Section 9</a>.<a href="#section-5-5" class="pilcrow">¶</a></p>
<div id="ipcrypt-deterministic">
<section id="section-5.1">
        <h3 id="name-ipcrypt-deterministic">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-ipcrypt-deterministic" class="section-name selfRef">ipcrypt-deterministic</a>
        </h3>
<p id="section-5.1-1">The <code>ipcrypt-deterministic</code> instantiation employs AES-128 in a single-block operation. The key MUST be 16 bytes (128 bits). As AES-128 is a permutation, each distinct input maps to a unique ciphertext, producing a valid IP address representation.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">Test vectors are provided in <a href="#ipcrypt-deterministic-test-vectors" class="auto internal xref">Appendix A.1</a>.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-3">
<pre>
      +---------------------+
      |      IP Address     |
      |    (IPv4 or IPv6)   |
      +---------------------+
                 |
                 v
      +---------------------+
      | Convert to 16 Bytes |
      +---------------------+
                 |
                 v
      +---------------------+
      |   AES128 Encrypt    |
      |   (Single Block)    |
      +---------------------+
                 |
                 v
      +---------------------+
      |    16-Byte Output   |
      +---------------------+
                 |
                 v
      +---------------------+
      | Convert to IP Format|
      +---------------------+
</pre><a href="#section-5.1-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="format-preservation-and-limitations">
<section id="section-5.2">
        <h3 id="name-format-preservation-and-lim">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-format-preservation-and-lim" class="section-name selfRef">Format Preservation and Limitations</a>
        </h3>
<div id="network-hierarchy-preservation">
<section id="section-5.2.1">
          <h4 id="name-network-hierarchy-preservat">
<a href="#section-5.2.1" class="section-number selfRef">5.2.1. </a><a href="#name-network-hierarchy-preservat" class="section-name selfRef">Network Hierarchy Preservation</a>
          </h4>
<p id="section-5.2.1-1">Most encryption methods in this specification scramble network hierarchy, with the notable exception of <code>ipcrypt-pfx</code>:<a href="#section-5.2.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.1-2.1">
              <p id="section-5.2.1-2.1.1"><code>ipcrypt-deterministic</code>, <code>ipcrypt-nd</code>, and <code>ipcrypt-ndx</code>: These methods completely scramble IPv4 and IPv6 prefixes in the encrypted output. Addresses from the same subnet appear unrelated after encryption, and geographic or topological proximity cannot be inferred.<a href="#section-5.2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.2.1-2.2">
              <p id="section-5.2.1-2.2.1"><code>ipcrypt-pfx</code>: This method preserves network prefix relationships in the encrypted output. Addresses from the same subnet share a common encrypted prefix, enabling network-level analytics while protecting the actual network identity. The encrypted prefixes themselves are cryptographically transformed and unrecognizable without the key.<a href="#section-5.2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="format-preservation-without-prefix-preservation">
<section id="section-5.2.2">
          <h4 id="name-format-preservation-without">
<a href="#section-5.2.2" class="section-number selfRef">5.2.2. </a><a href="#name-format-preservation-without" class="section-name selfRef">Format Preservation Without Prefix Preservation</a>
          </h4>
<p id="section-5.2.2-1">For methods other than <code>ipcrypt-pfx</code>, IPv4 addresses are typically encrypted as IPv6 addresses.<a href="#section-5.2.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2.2-2">IPv4 format preservation without prefix preservation (maintaining IPv4 addresses as IPv4 in deterministic or non-deterministic modes) is not specified in this document and is generally discouraged due to the limited 32-bit address space, which significantly reduces encryption security.<a href="#section-5.2.2-2" class="pilcrow">¶</a></p>
<p id="section-5.2.2-3">If IPv4 format preservation is absolutely required despite the security limitations, implementers SHOULD implement a Format-Preserving Encryption (FPE) mode such as the FF1 algorithm specified in <span>[<a href="#NIST-SP-800-38G" class="cite xref">NIST-SP-800-38G</a>]</span> or FAST <span>[<a href="#FAST" class="cite xref">FAST</a>]</span>.<a href="#section-5.2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="preserving-metadata-for-analytics">
<section id="section-5.2.3">
          <h4 id="name-preserving-metadata-for-ana">
<a href="#section-5.2.3" class="section-number selfRef">5.2.3. </a><a href="#name-preserving-metadata-for-ana" class="section-name selfRef">Preserving Metadata for Analytics</a>
          </h4>
<p id="section-5.2.3-1">Organizations requiring network metadata for analytics have two options:<a href="#section-5.2.3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.2.3-2">
<li id="section-5.2.3-2.1">
              <p id="section-5.2.3-2.1.1">Use <code>ipcrypt-pfx</code> to preserve network structure within the encrypted addresses, enabling network-level analysis while keeping actual network identities encrypted.<a href="#section-5.2.3-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-5.2.3-2.2">
              <p id="section-5.2.3-2.2.1">For non-prefix-preserving modes (<code>ipcrypt-deterministic</code>, <code>ipcrypt-nd</code>, <code>ipcrypt-ndx</code>), extract and store metadata (geographic location, ASN, network classification) as separate fields before encryption.<a href="#section-5.2.3-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-5.2.3-3">Both approaches provide advantages over IP address truncation, which provides inconsistent protection and irreversibly destroys data.<a href="#section-5.2.3-3" class="pilcrow">¶</a></p>
<p id="section-5.2.3-4">Recommended approach:
1. Extract metadata (geographic location, ASN, network type) from the original IP address
2. Store this information as separate fields alongside the encrypted IP address
3. Apply appropriate privacy-preserving aggregation to the metadata itself<a href="#section-5.2.3-4" class="pilcrow">¶</a></p>
<p id="section-5.2.3-5">Example storage schema:
~~~
{
  “encrypted_ip”: “bde9:6789:d353:824c:d7c6:f58a:6bd2:26eb”,
  “country”: “US”,
  “asn”: 15169,
  “network_type”: “cloud_provider”
}
~~~<a href="#section-5.2.3-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="prefix-preserving-encryption">
<section id="section-6">
      <h2 id="name-prefix-preserving-encryptio">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-prefix-preserving-encryptio" class="section-name selfRef">Prefix-Preserving Encryption</a>
      </h2>
<p id="section-6-1">Prefix-preserving encryption maintains network structure in encrypted IP addresses. Addresses from the same network produce encrypted addresses that share a common prefix, enabling privacy-preserving network analytics while preventing identification of specific networks or users.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">Unlike standard encryption that completely scrambles addresses, prefix-preserving encryption enables network operators to:<a href="#section-6-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-3.1">
          <p id="section-6-3.1.1">Detect traffic patterns from common networks without knowing which specific networks<a href="#section-6-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-3.2">
          <p id="section-6-3.2.1">Perform network-level rate limiting on encrypted addresses<a href="#section-6-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-3.3">
          <p id="section-6-3.3.1">Implement DDoS mitigation while preserving user privacy<a href="#section-6-3.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-3.4">
          <p id="section-6-3.4.1">Analyze network topology without accessing raw IP addresses<a href="#section-6-3.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-6-4">This mode balances privacy with analytical capability: individual addresses remain encrypted and network identities are cryptographically transformed, but network relationships remain visible through shared encrypted prefixes.<a href="#section-6-4" class="pilcrow">¶</a></p>
<div id="prefix-preserving-construction">
<section id="section-6.1">
        <h3 id="name-prefix-preserving-construct">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-prefix-preserving-construct" class="section-name selfRef">Prefix-Preserving Construction</a>
        </h3>
<p id="section-6.1-1">The encryption process achieves prefix preservation through a bit-by-bit transformation that maintains consistency across addresses with shared prefixes. For any two IP addresses sharing the first N bits, their encrypted forms also share the first N bits. This property holds recursively for all prefix lengths.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">The algorithm operates as follows:<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.1-3">
<li id="section-6.1-3.1">
            <p id="section-6.1-3.1.1">Process each bit position sequentially from most significant to least significant<a href="#section-6.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.1-3.2">
            <p id="section-6.1-3.2.1">For each bit position, extract the prefix (all bits processed so far) from the original IP address<a href="#section-6.1-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.1-3.3">
            <p id="section-6.1-3.3.1">Apply a pseudorandom function (PRF) that takes the padded prefix as input to generate a cipher bit<a href="#section-6.1-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.1-3.4">
            <p id="section-6.1-3.4.1">XOR the cipher bit with the original bit at the current position to produce the encrypted bit<a href="#section-6.1-3.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.1-3.5">
            <p id="section-6.1-3.5.1">The encrypted bit depends deterministically on the prefix from the original IP, ensuring identical prefixes always produce identical encrypted prefixes<a href="#section-6.1-3.5.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-6.1-4">This construction ensures:<a href="#section-6.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-5.1">
            <p id="section-6.1-5.1.1">Identical prefixes always produce identical transformations for subsequent bits<a href="#section-6.1-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.1-5.2">
            <p id="section-6.1-5.2.1">Different prefixes produce cryptographically distinct transformations<a href="#section-6.1-5.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.1-5.3">
            <p id="section-6.1-5.3.1">The transformation is deterministic yet cryptographically secure<a href="#section-6.1-5.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.1-5.4">
            <p id="section-6.1-5.4.1">Network relationships are preserved while actual network identities remain encrypted<a href="#section-6.1-5.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-6.1-6">The algorithm maintains native address sizes: IPv4 addresses remain 4 bytes (32 bits) and IPv6 addresses remain 16 bytes (128 bits).<a href="#section-6.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="concrete-instantiation-ipcrypt-pfx">
<section id="section-6.2">
        <h3 id="name-concrete-instantiation-ipcr">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-concrete-instantiation-ipcr" class="section-name selfRef">Concrete Instantiation: ipcrypt-pfx</a>
        </h3>
<p id="section-6.2-1">The <code>ipcrypt-pfx</code> instantiation implements prefix-preserving encryption using a pseudorandom function based on the XOR of two independently keyed AES-128 encryptions.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<div id="pseudorandom-function-construction">
<section id="section-6.2.1">
          <h4 id="name-pseudorandom-function-const">
<a href="#section-6.2.1" class="section-number selfRef">6.2.1. </a><a href="#name-pseudorandom-function-const" class="section-name selfRef">Pseudorandom Function Construction</a>
          </h4>
<p id="section-6.2.1-1">The pseudorandom function requires a 32-byte key split into two independent 16-byte AES-128 keys (<code>K1</code> and <code>K2</code>). For each bit position, the algorithm performs:<a href="#section-6.2.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.2.1-2">
<li id="section-6.2.1-2.1">
              <p id="section-6.2.1-2.1.1">Padding: The prefix (all bits processed so far from the original IP address) is padded to 128 bits using the format <code>zeros || 1 || prefix_bits</code>, where:<a href="#section-6.2.1-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2.1-2.1.2.1">
                  <p id="section-6.2.1-2.1.2.1.1">The prefix bits are extracted from the most significant bits of the original IP address<a href="#section-6.2.1-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-6.2.1-2.1.2.2">
                  <p id="section-6.2.1-2.1.2.2.1">A single <code>1</code> bit serves as a delimiter at position <code>prefix_len_bits</code><a href="#section-6.2.1-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-6.2.1-2.1.2.3">
                  <p id="section-6.2.1-2.1.2.3.1">The prefix bits are placed immediately after the delimiter, from high to low positions<a href="#section-6.2.1-2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-6.2.1-2.1.2.4">
                  <p id="section-6.2.1-2.1.2.4.1">For an empty prefix (processing the first bit), this produces a block with only a single <code>1</code> bit at position 0<a href="#section-6.2.1-2.1.2.4.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li id="section-6.2.1-2.2">
              <p id="section-6.2.1-2.2.1">Dual Encryption: The padded prefix is encrypted independently with both <code>K1</code> and <code>K2</code>, producing two 128-bit outputs (<code>e1</code> and <code>e2</code>).<a href="#section-6.2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-6.2.1-2.3">
              <p id="section-6.2.1-2.3.1">XOR Combination: The final PRF output is computed as <code>e = e1 ⊕ e2</code>.<a href="#section-6.2.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
<div id="bit-encryption-process">
<section id="section-6.2.2">
          <h4 id="name-bit-encryption-process">
<a href="#section-6.2.2" class="section-number selfRef">6.2.2. </a><a href="#name-bit-encryption-process" class="section-name selfRef">Bit Encryption Process</a>
          </h4>
<p id="section-6.2.2-1">For each bit position (processing from MSB to LSB):<a href="#section-6.2.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.2.2-2">
<li id="section-6.2.2-2.1">
              <p id="section-6.2.2-2.1.1">Pad the prefix (bits processed so far from the original IP) to 128 bits<a href="#section-6.2.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-6.2.2-2.2">
              <p id="section-6.2.2-2.2.1">Compute the PRF output using the padded prefix: <code>e = AES(K1, padded_prefix) ⊕ AES(K2, padded_prefix)</code><a href="#section-6.2.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-6.2.2-2.3">
              <p id="section-6.2.2-2.3.1">Extract the least significant bit from the PRF output as the cipher bit<a href="#section-6.2.2-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-6.2.2-2.4">
              <p id="section-6.2.2-2.4.1">XOR the cipher bit with the original bit at the current position to produce the encrypted bit<a href="#section-6.2.2-2.4.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-6.2.2-3">Complete pseudocode implementation is provided in <a href="#prefix-preserving-encryption-ipcrypt-pfx" class="auto internal xref">Section 9.6</a>.<a href="#section-6.2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="key-requirements">
<section id="section-6.2.3">
          <h4 id="name-key-requirements">
<a href="#section-6.2.3" class="section-number selfRef">6.2.3. </a><a href="#name-key-requirements" class="section-name selfRef">Key Requirements</a>
          </h4>
<p id="section-6.2.3-1">The two 16-byte halves of the 32-byte key (<code>K1</code> and <code>K2</code>) MUST NOT be identical. Using identical values for <code>K1</code> and <code>K2</code> (e.g., repeating the same 16 bytes twice) causes the XOR operation to cancel out, returning the original IP address unchanged.<a href="#section-6.2.3-1" class="pilcrow">¶</a></p>
<p id="section-6.2.3-2">When the 32-byte key is randomly sampled from a uniform distribution, the probability that <code>K1 = K2</code> is statistically negligible.<a href="#section-6.2.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-properties">
<section id="section-6.2.4">
          <h4 id="name-security-properties">
<a href="#section-6.2.4" class="section-number selfRef">6.2.4. </a><a href="#name-security-properties" class="section-name selfRef">Security Properties</a>
          </h4>
<p id="section-6.2.4-1">The <code>ipcrypt-pfx</code> construction improves upon earlier designs such as CRYPTO-Pan through enhanced cryptographic security:<a href="#section-6.2.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2.4-2.1">
              <p id="section-6.2.4-2.1.1">Sum-of-Permutations: The XOR of two independently keyed AES-128 permutations provides security beyond the birthday bound <span>[<a href="#SUM-OF-PRPS" class="cite xref">SUM-OF-PRPS</a>]</span>, supporting more than 2<sup>78</sup> distinct IP addresses per key <span>[<a href="#REVISITING-SUM" class="cite xref">REVISITING-SUM</a>]</span>. This construction ensures that even with billions of encrypted addresses, security remains robust.<a href="#section-6.2.4-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-6.2.4-2.2">
              <p id="section-6.2.4-2.2.1">Prefix-Based Context Isolation: Each bit depends on the entire prefix history.<a href="#section-6.2.4-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-6.2.4-3">Note: Prefix-preserving encryption intentionally reveals network structure to enable analytics. Organizations requiring complete address obfuscation should use non-prefix-preserving modes.<a href="#section-6.2.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="implementation-considerations">
<section id="section-6.2.5">
          <h4 id="name-implementation-consideratio">
<a href="#section-6.2.5" class="section-number selfRef">6.2.5. </a><a href="#name-implementation-consideratio" class="section-name selfRef">Implementation Considerations</a>
          </h4>
<p id="section-6.2.5-1">Key implementation characteristics:<a href="#section-6.2.5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2.5-2.1">
              <p id="section-6.2.5-2.1.1">Computational Requirements:<a href="#section-6.2.5-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2.5-2.1.2.1">
                  <p id="section-6.2.5-2.1.2.1.1">IPv4: 64 AES-128 operations per address (2 encryptions × 32 bits)<a href="#section-6.2.5-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-6.2.5-2.1.2.2">
                  <p id="section-6.2.5-2.1.2.2.1">IPv6: 256 AES-128 operations per address (2 encryptions × 128 bits)<a href="#section-6.2.5-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-6.2.5-2.2">
              <p id="section-6.2.5-2.2.1">Performance Optimizations:<a href="#section-6.2.5-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2.5-2.2.2.1">
                  <p id="section-6.2.5-2.2.2.1.1">Caching encrypted prefix values (<code>e1</code> and <code>e2</code>) significantly improves performance for addresses sharing common prefixes<a href="#section-6.2.5-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-6.2.5-2.2.2.2">
                  <p id="section-6.2.5-2.2.2.2.1">The encryption algorithm is inherently parallelizable since AES computations for different bit positions are independent<a href="#section-6.2.5-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-6.2.5-2.2.2.3">
                  <p id="section-6.2.5-2.2.2.3.1">The padded prefix computation can be optimized by maintaining state across iterations: instead of recomputing the padded prefix from scratch for each bit position, implementations can shift the previous padded prefix left by one bit and insert the next input bit.<a href="#section-6.2.5-2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
          </ul>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="non-deterministic-encryption">
<section id="section-7">
      <h2 id="name-non-deterministic-encryptio">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-non-deterministic-encryptio" class="section-name selfRef">Non-Deterministic Encryption</a>
      </h2>
<p id="section-7-1">Non-deterministic encryption enhances privacy by ensuring that the same IP address produces different ciphertexts each time it is encrypted, preventing correlation attacks that plague deterministic schemes. This is achieved through tweakable block ciphers that incorporate random values called tweaks.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">Non-deterministic encryption is appropriate when:<a href="#section-7-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-3.1">
          <p id="section-7-3.1.1">Preventing correlation of the same IP address across records is critical<a href="#section-7-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-3.2">
          <p id="section-7-3.2.1">Storage can accommodate the additional tweak data (8-16 bytes)<a href="#section-7-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-3.3">
          <p id="section-7-3.3.1">Stronger privacy guarantees than deterministic encryption provides are required<a href="#section-7-3.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-3.4">
          <p id="section-7-3.4.1">Processing the same address multiple times without revealing repetition patterns<a href="#section-7-3.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-7-4">Implementation details are provided in <a href="#implementation-details" class="auto internal xref">Section 9</a>.<a href="#section-7-4" class="pilcrow">¶</a></p>
<div id="encryption-process">
<section id="section-7.1">
        <h3 id="name-encryption-process">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-encryption-process" class="section-name selfRef">Encryption Process</a>
        </h3>
<p id="section-7.1-1">Encryption process for non-deterministic modes:<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.1-2">
<li id="section-7.1-2.1">
            <p id="section-7.1-2.1.1">Generate a random tweak using a cryptographically secure random number generator<a href="#section-7.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.1-2.2">
            <p id="section-7.1-2.2.1">Convert the IP address to its 16-byte representation<a href="#section-7.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.1-2.3">
            <p id="section-7.1-2.3.1">Encrypt the 16-byte representation using the key and the tweak<a href="#section-7.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.1-2.4">
            <p id="section-7.1-2.4.1">Concatenate the tweak with the encrypted output to form the final ciphertext<a href="#section-7.1-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-7.1-3">The tweak is not considered secret and is included in the ciphertext, enabling its use for decryption.<a href="#section-7.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="decryption-process">
<section id="section-7.2">
        <h3 id="name-decryption-process">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-decryption-process" class="section-name selfRef">Decryption Process</a>
        </h3>
<p id="section-7.2-1">Decryption process:<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.2-2">
<li id="section-7.2-2.1">
            <p id="section-7.2-2.1.1">Split the ciphertext into the tweak and the encrypted IP<a href="#section-7.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.2-2.2">
            <p id="section-7.2-2.2.1">Decrypt the encrypted IP using the key and the tweak<a href="#section-7.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.2-2.3">
            <p id="section-7.2-2.3.1">Convert the resulting 16-byte representation back to an IP address<a href="#section-7.2-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-7.2-3">Although the tweak is generated uniformly at random, occasional collisions may occur according to birthday bounds. An <code>(input, tweak)</code> collision reveals that the same input was encrypted with the same tweak but does not disclose the input’s value. The usage limits apply per cryptographic key; rotating keys extends secure usage beyond these bounds.<a href="#section-7.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="output-format-and-encoding">
<section id="section-7.3">
        <h3 id="name-output-format-and-encoding">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-output-format-and-encoding" class="section-name selfRef">Output Format and Encoding</a>
        </h3>
<p id="section-7.3-1">The output of non-deterministic encryption is binary data. For text representation, the binary output MUST be encoded (e.g., hexadecimal or Base64). Implementations SHOULD document their chosen encoding method.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="concrete-instantiations">
<section id="section-7.4">
        <h3 id="name-concrete-instantiations">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-concrete-instantiations" class="section-name selfRef">Concrete Instantiations</a>
        </h3>
<p id="section-7.4-1">This document defines two concrete instantiations:<a href="#section-7.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.4-2.1">
            <p id="section-7.4-2.1.1"><code>ipcrypt-nd</code>: Uses the KIASU-BC tweakable block cipher with an 8-byte (64-bit) tweak. See <span>[<a href="#KIASU-BC" class="cite xref">KIASU-BC</a>]</span> for details.<a href="#section-7.4-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.4-2.2">
            <p id="section-7.4-2.2.1"><code>ipcrypt-ndx</code>: Uses the AES-XTS tweakable block cipher with a 16-byte (128-bit) tweak. See <span>[<a href="#XTS-AES" class="cite xref">XTS-AES</a>]</span> for background.<a href="#section-7.4-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-7.4-3">In both cases, if a tweak is generated randomly, it MUST be uniformly random. Reusing the same randomly generated tweak on different inputs is acceptable from a confidentiality standpoint.<a href="#section-7.4-3" class="pilcrow">¶</a></p>
<p id="section-7.4-4">Test vectors are provided in <a href="#ipcrypt-nd-test-vectors" class="auto internal xref">Appendix A.3</a> and <a href="#ipcrypt-ndx-test-vectors" class="auto internal xref">Appendix A.4</a>.<a href="#section-7.4-4" class="pilcrow">¶</a></p>
<div id="ipcrypt-nd">
<section id="section-7.4.1">
          <h4 id="name-ipcrypt-nd-kiasu-bc">
<a href="#section-7.4.1" class="section-number selfRef">7.4.1. </a><a href="#name-ipcrypt-nd-kiasu-bc" class="section-name selfRef">ipcrypt-nd (KIASU-BC)</a>
          </h4>
<p id="section-7.4.1-1">The <code>ipcrypt-nd</code> instantiation uses the KIASU-BC tweakable block cipher with an 8-byte (64-bit) tweak. Implementation details are provided in <a href="#implementing-kiasu-bc" class="auto internal xref">Section 9.9</a>. The output is 24 bytes total, consisting of an 8-byte tweak concatenated with a 16-byte ciphertext.<a href="#section-7.4.1-1" class="pilcrow">¶</a></p>
<p id="section-7.4.1-2">Random sampling of an 8-byte tweak yields an expected collision after about 2<sup>32</sup> operations (approximately 4 billion). An <code>(input, tweak)</code> collision indicates repetition without revealing the input’s value.<a href="#section-7.4.1-2" class="pilcrow">¶</a></p>
<p id="section-7.4.1-3">These collision bounds apply per cryptographic key. Regular key rotation can extend secure usage beyond these bounds. The effective security is determined by the underlying block cipher’s strength.<a href="#section-7.4.1-3" class="pilcrow">¶</a></p>
<p id="section-7.4.1-4">Test vectors are provided in <a href="#ipcrypt-nd-test-vectors" class="auto internal xref">Appendix A.3</a>.<a href="#section-7.4.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ipcrypt-ndx">
<section id="section-7.4.2">
          <h4 id="name-ipcrypt-ndx-aes-xts">
<a href="#section-7.4.2" class="section-number selfRef">7.4.2. </a><a href="#name-ipcrypt-ndx-aes-xts" class="section-name selfRef">ipcrypt-ndx (AES-XTS)</a>
          </h4>
<p id="section-7.4.2-1">The <code>ipcrypt-ndx</code> instantiation uses the AES-XTS tweakable block cipher with a 16-byte (128-bit) tweak. The output is 32 bytes total, consisting of a 16-byte tweak concatenated with a 16-byte ciphertext.<a href="#section-7.4.2-1" class="pilcrow">¶</a></p>
<p id="section-7.4.2-2">For single-block AES-XTS, independent sampling of a 16-byte tweak results in an expected collision after about 2<sup>64</sup> operations (approximately 18 quintillion).<a href="#section-7.4.2-2" class="pilcrow">¶</a></p>
<p id="section-7.4.2-3">Similar to <code>ipcrypt-nd</code>, collisions reveal repetition without compromising the input value. These limits are per key, and regular key rotation extends secure usage. The effective security is governed by AES-128 strength (approximately 2<sup>128</sup> operations).<a href="#section-7.4.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="comparison-of-modes">
<section id="section-7.4.3">
          <h4 id="name-comparison-of-modes">
<a href="#section-7.4.3" class="section-number selfRef">7.4.3. </a><a href="#name-comparison-of-modes" class="section-name selfRef">Comparison of Modes</a>
          </h4>
<p id="section-7.4.3-1">Mode selection depends on specific privacy requirements and operational constraints:<a href="#section-7.4.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.4.3-2.1">
              <p id="section-7.4.3-2.1.1">Deterministic (<code>ipcrypt-deterministic</code>):<a href="#section-7.4.3-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.4.3-2.1.2.1">
                  <p id="section-7.4.3-2.1.2.1.1">Output size: 16 bytes (most compact)<a href="#section-7.4.3-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-7.4.3-2.1.2.2">
                  <p id="section-7.4.3-2.1.2.2.1">Privacy: Same IP always produces same ciphertext (allows correlation)<a href="#section-7.4.3-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-7.4.3-2.1.2.3">
                  <p id="section-7.4.3-2.1.2.3.1">Use case: When duplicate identification is needed or when format preservation is critical<a href="#section-7.4.3-2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-7.4.3-2.1.2.4">
                  <p id="section-7.4.3-2.1.2.4.1">Performance: Fastest (single AES operation)<a href="#section-7.4.3-2.1.2.4.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-7.4.3-2.2">
              <p id="section-7.4.3-2.2.1">Prefix-Preserving (<code>ipcrypt-pfx</code>):<a href="#section-7.4.3-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.4.3-2.2.2.1">
                  <p id="section-7.4.3-2.2.2.1.1">Output size: 4 bytes for IPv4, 16 bytes for IPv6 (maintains native sizes)<a href="#section-7.4.3-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-7.4.3-2.2.2.2">
                  <p id="section-7.4.3-2.2.2.2.1">Privacy: Preserves network prefix relationships while encrypting actual network identities<a href="#section-7.4.3-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-7.4.3-2.2.2.3">
                  <p id="section-7.4.3-2.2.2.3.1">Use case: Network analytics, traffic pattern analysis, subnet monitoring, DDoS mitigation<a href="#section-7.4.3-2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-7.4.3-2.2.2.4">
                  <p id="section-7.4.3-2.2.2.4.1">Performance: Bit-by-bit processing (64 AES operations for IPv4, 256 for IPv6)<a href="#section-7.4.3-2.2.2.4.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-7.4.3-2.3">
              <p id="section-7.4.3-2.3.1">Non-Deterministic <code>ipcrypt-nd</code> (KIASU-BC):<a href="#section-7.4.3-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.4.3-2.3.2.1">
                  <p id="section-7.4.3-2.3.2.1.1">Output size: 24 bytes (16-byte ciphertext + 8-byte tweak)<a href="#section-7.4.3-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-7.4.3-2.3.2.2">
                  <p id="section-7.4.3-2.3.2.2.1">Privacy: Same IP produces different ciphertexts (prevents most correlation)<a href="#section-7.4.3-2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-7.4.3-2.3.2.3">
                  <p id="section-7.4.3-2.3.2.3.1">Use case: General privacy protection with reasonable storage overhead<a href="#section-7.4.3-2.3.2.3.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-7.4.3-2.3.2.4">
                  <p id="section-7.4.3-2.3.2.4.1">Collision resistance: Approximately 4 billion operations per key<a href="#section-7.4.3-2.3.2.4.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-7.4.3-2.4">
              <p id="section-7.4.3-2.4.1">Non-Deterministic <code>ipcrypt-ndx</code> (AES-XTS):<a href="#section-7.4.3-2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.4.3-2.4.2.1">
                  <p id="section-7.4.3-2.4.2.1.1">Output size: 32 bytes (16-byte ciphertext + 16-byte tweak)<a href="#section-7.4.3-2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-7.4.3-2.4.2.2">
                  <p id="section-7.4.3-2.4.2.2.1">Privacy: Same IP produces different ciphertexts (prevents correlation)<a href="#section-7.4.3-2.4.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-7.4.3-2.4.2.3">
                  <p id="section-7.4.3-2.4.2.3.1">Use case: Maximum privacy protection when storage permits<a href="#section-7.4.3-2.4.2.3.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-7.4.3-2.4.2.4">
                  <p id="section-7.4.3-2.4.2.4.1">Collision resistance: Approximately 18 quintillion operations per key<a href="#section-7.4.3-2.4.2.4.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="alternatives-to-random-tweaks">
<section id="section-7.5">
        <h3 id="name-alternatives-to-random-twea">
<a href="#section-7.5" class="section-number selfRef">7.5. </a><a href="#name-alternatives-to-random-twea" class="section-name selfRef">Alternatives to Random Tweaks</a>
        </h3>
<p id="section-7.5-1">While this specification recommends uniformly random tweaks for non-deterministic encryption, alternative approaches may be considered:<a href="#section-7.5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.5-2.1">
            <p id="section-7.5-2.1.1">Monotonic Counter: A counter could be used as a tweak, but this is difficult to maintain in distributed systems. If the counter is not encrypted and the tweakable block cipher is not secure against related-tweak attacks, this could enable correlation attacks.<a href="#section-7.5-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.5-2.2">
            <p id="section-7.5-2.2.1">UUIDs: UUIDs (such as UUIDv6 or UUIDv7) could be used as tweaks; however, these would reveal the original timestamp of the logged IP addresses, which may not be desirable from a privacy perspective.<a href="#section-7.5-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-7.5-3">Although the birthday bound presents considerations with random tweaks, random tweaks remain the recommended approach for practical deployments.<a href="#section-7.5-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-8">
      <h2 id="name-security-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-8-1">The methods specified in this document provide strong confidentiality guarantees but explicitly do not provide integrity protection:<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">These methods provide protection against:<a href="#section-8-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-3.1">
          <p id="section-8-3.1.1">Unauthorized parties learning the original IP addresses (without the key)<a href="#section-8-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-8-3.2">
          <p id="section-8-3.2.1">Statistical analysis revealing patterns in network traffic (non-deterministic modes)<a href="#section-8-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-8-3.3">
          <p id="section-8-3.3.1">Brute-force attacks on the address space (128-bit security level)<a href="#section-8-3.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-8-4">These methods do not provide protection against:<a href="#section-8-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-5.1">
          <p id="section-8-5.1.1">Active attackers modifying, reordering, or removing encrypted addresses<a href="#section-8-5.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-8-5.2">
          <p id="section-8-5.2.1">Authorized key holders decrypting addresses (by design)<a href="#section-8-5.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-8-5.3">
          <p id="section-8-5.3.1">Traffic analysis based on volume and timing (metadata)<a href="#section-8-5.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-8-6">Applications requiring integrity protection must additionally employ authentication mechanisms such as HMAC, authenticated encryption modes, or digital signatures over the encrypted data.<a href="#section-8-6" class="pilcrow">¶</a></p>
<div id="deterministic-mode-security">
<section id="section-8.1">
        <h3 id="name-deterministic-mode-security">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-deterministic-mode-security" class="section-name selfRef">Deterministic Mode Security</a>
        </h3>
<p id="section-8.1-1">A permutation ensures distinct inputs yield distinct outputs. Repeated inputs result in identical ciphertexts, revealing repetition.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2">This makes deterministic encryption suitable for applications where format preservation is required and linkability is acceptable.<a href="#section-8.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="non-deterministic-mode-security">
<section id="section-8.2">
        <h3 id="name-non-deterministic-mode-secu">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-non-deterministic-mode-secu" class="section-name selfRef">Non-Deterministic Mode Security</a>
        </h3>
<p id="section-8.2-1">The inclusion of a random tweak ensures that encrypting the same input generally produces different outputs. An <code>(input, tweak)</code> collision reveals only that the same input was processed with that tweak, not the input’s value.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">Security is determined by the underlying block cipher (≈2<sup>128</sup> for AES-128) on a per-key basis. Key rotation is recommended to extend secure usage beyond the per-key collision bounds.<a href="#section-8.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="implementation-security">
<section id="section-8.3">
        <h3 id="name-implementation-security">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-implementation-security" class="section-name selfRef">Implementation Security</a>
        </h3>
<p id="section-8.3-1">Implementations MUST ensure that:<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8.3-2">
<li id="section-8.3-2.1">
            <p id="section-8.3-2.1.1">Keys are generated using a cryptographically secure random number generator<a href="#section-8.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-8.3-2.2">
            <p id="section-8.3-2.2.1">Tweak values are uniformly random for non-deterministic modes<a href="#section-8.3-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-8.3-2.3">
            <p id="section-8.3-2.3.1">Side-channel attacks are mitigated through constant-time operations<a href="#section-8.3-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-8.3-2.4">
            <p id="section-8.3-2.4.1">Error handling does not leak sensitive information<a href="#section-8.3-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ol>
</section>
</div>
<div id="key-management-considerations">
<section id="section-8.4">
        <h3 id="name-key-management-consideratio">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-key-management-consideratio" class="section-name selfRef">Key Management Considerations</a>
        </h3>
<p id="section-8.4-1">Implementers MUST ensure:<a href="#section-8.4-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8.4-2">
<li id="section-8.4-2.1">
            <p id="section-8.4-2.1.1">Keys are generated using cryptographically secure random number generators (see <span>[<a href="#RFC4086" class="cite xref">RFC4086</a>]</span>)<a href="#section-8.4-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-8.4-2.2">
            <p id="section-8.4-2.2.1">Keys are stored securely and access-controlled appropriately for the deployment environment<a href="#section-8.4-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-8.4-2.3">
            <p id="section-8.4-2.3.1">Key rotation policies are established based on usage volume and security requirements<a href="#section-8.4-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-8.4-2.4">
            <p id="section-8.4-2.4.1">Key compromise procedures are defined and tested<a href="#section-8.4-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-8.4-3">For high-volume deployments processing billions of IP addresses, regular key rotation (e.g., monthly or quarterly) is RECOMMENDED to stay well within the security bounds discussed in this document.<a href="#section-8.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="implementation-details">
<section id="section-9">
      <h2 id="name-implementation-details">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-implementation-details" class="section-name selfRef">Implementation Details</a>
      </h2>
<p id="section-9-1">This section provides pseudocode and implementation guidance for the operations described in this document.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">In the pseudocode throughout this document, the notation “for i from x to y” indicates iteration starting at x (inclusive) and ending before y (exclusive). For example, “for i from 0 to 4” processes values 0, 1, 2, and 3, but not 4.<a href="#section-9-2" class="pilcrow">¶</a></p>
<div id="diagrams">
<section id="section-9.1">
        <h3 id="name-visual-diagrams">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-visual-diagrams" class="section-name selfRef">Visual Diagrams</a>
        </h3>
<p id="section-9.1-1">The following diagrams illustrate the processes described in this specification.<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<div id="ipv4-address-conversion-diagram">
<section id="section-9.1.1">
          <h4 id="name-ipv4-address-conversion-dia">
<a href="#section-9.1.1" class="section-number selfRef">9.1.1. </a><a href="#name-ipv4-address-conversion-dia" class="section-name selfRef">IPv4 Address Conversion Diagram</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-9.1.1-1">
<pre>
                 IPv4: 192.0.2.1
                        |
                        v
               Octets:  C0 00 02 01
                        |
                        v
                  16-Byte Array:
[00 00 00 00 00 00 00 00 00 00 | FF FF | C0 00 02 01]
</pre><a href="#section-9.1.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="deterministic-encryption-flow">
<section id="section-9.1.2">
          <h4 id="name-deterministic-encryption-fl">
<a href="#section-9.1.2" class="section-number selfRef">9.1.2. </a><a href="#name-deterministic-encryption-fl" class="section-name selfRef">Deterministic Encryption Flow</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-9.1.2-1">
<pre>
            IP Address
                |
                v
       [Convert to 16 Bytes]
                |
                v
   [AES-128 Single-Block Encrypt]
                |
                v
       16-Byte Ciphertext
                |
                v
     [Convert to IP Format]
                |
                v
       Encrypted IP Address
</pre><a href="#section-9.1.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="prefix-preserving-encryption-flow-ipcrypt-pfx">
<section id="section-9.1.3">
          <h4 id="name-prefix-preserving-encryption">
<a href="#section-9.1.3" class="section-number selfRef">9.1.3. </a><a href="#name-prefix-preserving-encryption" class="section-name selfRef">Prefix-Preserving Encryption Flow (ipcrypt-pfx)</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-9.1.3-1">
<pre>
            IP Address
                |
                v
       [Convert to 16 Bytes]
                |
                v
  [Split 32-byte key into K1, K2]
                |
                v
  [For each bit position (MSB to LSB):
  - Pad current prefix to 128 bits:
    zeros || 1 || prefix_bits
  - e1 = AES(K1, padded_prefix)
  - e2 = AES(K2, padded_prefix)
  - e = e1 ⊕ e2
  - Extract LSB from e as cipher_bit
  - XOR cipher_bit with original bit
  - Set result bit in encrypted output
  - Add original bit to prefix for next iteration]
                |
                v
       Encrypted IP Address
  (4 bytes for IPv4, 16 bytes for IPv6)
</pre><a href="#section-9.1.3-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="non-deterministic-encryption-flow-ipcrypt-nd">
<section id="section-9.1.4">
          <h4 id="name-non-deterministic-encryption">
<a href="#section-9.1.4" class="section-number selfRef">9.1.4. </a><a href="#name-non-deterministic-encryption" class="section-name selfRef">Non-Deterministic Encryption Flow (ipcrypt-nd)</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-9.1.4-1">
<pre>
              IP Address
                  |
                  v
       [Convert to 16 Bytes]
                  |
                  v
    [Generate Random 8-Byte Tweak]
                  |
                  v
       [KIASU-BC Tweakable Encrypt]
                  |
                  v
          16-Byte Ciphertext
                  |
                  v
    [Concatenate Tweak || Ciphertext]
                  |
                  v
       24-Byte Output (ipcrypt-nd)
</pre><a href="#section-9.1.4-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="non-deterministic-encryption-flow-ipcrypt-ndx">
<section id="section-9.1.5">
          <h4 id="name-non-deterministic-encryption-">
<a href="#section-9.1.5" class="section-number selfRef">9.1.5. </a><a href="#name-non-deterministic-encryption-" class="section-name selfRef">Non-Deterministic Encryption Flow (ipcrypt-ndx)</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-9.1.5-1">
<pre>
              IP Address
                  |
                  v
       [Convert to 16 Bytes]
                  |
                  v
    [Generate Random 16-Byte Tweak]
                  |
                  v
       [AES-XTS Tweakable Encrypt]
                  |
                  v
          16-Byte Ciphertext
                  |
                  v
    [Concatenate Tweak || Ciphertext]
                  |
                  v
       32-Byte Output (ipcrypt-ndx)
</pre><a href="#section-9.1.5-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="ipv4-address-conversion">
<section id="section-9.2">
        <h3 id="name-ipv4-address-conversion">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-ipv4-address-conversion" class="section-name selfRef">IPv4 Address Conversion</a>
        </h3>
<p id="section-9.2-1">See <a href="#ipv4-address-conversion-diagram" class="auto internal xref">Section 9.1.1</a> for a diagram of this process.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<div class="lang-pseudocode sourcecode" id="section-9.2-2">
<pre>
function ipv4_to_16_bytes(ipv4_address):
    // Parse the IPv4 address into 4 octets
    octets = parseIPv4(ipv4_address)  // Returns 4 octets
    // Create a 16-byte array with the IPv4-mapped prefix
    bytes16 = [0x00] * 10         // 10 bytes of 0x00
    bytes16.append(0xFF)          // 11th byte: 0xFF
    bytes16.append(0xFF)          // 12th byte: 0xFF
    // Append each octet (converted to an 8-bit integer)
    for octet in octets:
         bytes16.append(octet)
    return bytes16
</pre><a href="#section-9.2-2" class="pilcrow">¶</a>
</div>
<p id="section-9.2-3"><em>Example:</em> For <code>"192.0.2.1"</code>, the function returns<a href="#section-9.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9.2-4">
<pre>
[00, 00, 00, 00, 00, 00, 00, 00, 00, 00, FF, FF, C0, 00, 02, 01]
</pre><a href="#section-9.2-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="ipv6-address-conversion">
<section id="section-9.3">
        <h3 id="name-ipv6-address-conversion">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-ipv6-address-conversion" class="section-name selfRef">IPv6 Address Conversion</a>
        </h3>
<div class="lang-pseudocode sourcecode" id="section-9.3-1">
<pre>
function ipv6_to_16_bytes(ipv6_address):
    // Parse the IPv6 address into eight 16-bit words.
    words = parseIPv6(ipv6_address)  // Expands shorthand notation and returns 8 words
    bytes16 = []
    for word in words:
         high_byte = (word &gt;&gt; 8) &amp; 0xFF
         low_byte = word &amp; 0xFF
         bytes16.append(high_byte)
         bytes16.append(low_byte)
    return bytes16
</pre><a href="#section-9.3-1" class="pilcrow">¶</a>
</div>
<p id="section-9.3-2"><em>Example:</em> For <code>"2001:0db8:85a3:0000:0000:8a2e:0370:7334"</code>, the output is the corresponding 16-byte sequence <code>{0x20, 0x01, 0x0d, 0xb8, ..., 0x34}</code>.<a href="#section-9.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conversion-from-a-16-byte-array-to-an-ip-address-string">
<section id="section-9.4">
        <h3 id="name-conversion-from-a-16-byte-a">
<a href="#section-9.4" class="section-number selfRef">9.4. </a><a href="#name-conversion-from-a-16-byte-a" class="section-name selfRef">Conversion from a 16-Byte Array to an IP Address String</a>
        </h3>
<p id="section-9.4-1">This function converts a 16-byte array back to an IP address string. For IPv6 addresses, the output conforms to <span>[<a href="#RFC5952" class="cite xref">RFC5952</a>]</span>. Implementers SHOULD use existing IP address formatting functions from standard libraries.<a href="#section-9.4-1" class="pilcrow">¶</a></p>
<div class="breakable lang-pseudocode sourcecode" id="section-9.4-2">
<pre>
function bytes_16_to_ip(bytes16):
    if length(bytes16) != 16:
         raise Error("Invalid byte array")

    // Check for the IPv4-mapped prefix
    // When an IPv4-mapped IPv6 address (::ffff:x.x.x.x) is detected,
    // it is converted back to IPv4 format. This is expected
    // behavior as IPv4 addresses are internally represented as IPv4-mapped
    // IPv6 addresses for uniform processing.
    ipv4_mapped_prefix = [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF]
    if bytes16[0..12] == ipv4_mapped_prefix:
         // Convert the 4 last bytes to an IPv4 address
         ipv4_parts = []
         for i from 12 to 16:
             ipv4_parts.append(integer_to_string(bytes16[i]))
         ipv4_address = join(ipv4_parts, ".")
         return ipv4_address
    else:
         // Convert the 16 bytes to an IPv6 address with canonical representation
         words = []
         for i from 0 to 8:
             word = (bytes16[i*2] &lt;&lt; 8) | bytes16[i*2+1]
             words.append(word)

         // Find longest run of consecutive zeros for compression
         best_run_start = -1
         best_run_length = 0
         run_start = -1

         for i from 0 to 8:
             if words[i] == 0:
                 if run_start == -1:
                     run_start = i
             else:
                 if run_start != -1:
                     run_length = i - run_start
                     if run_length &gt; best_run_length:
                         best_run_start = run_start
                         best_run_length = run_length
                     run_start = -1

         // Check final run
         if run_start != -1:
             run_length = 8 - run_start
             if run_length &gt; best_run_length:
                 best_run_start = run_start
                 best_run_length = run_length

         // Build IPv6 string with zero compression
         parts = []
         i = 0
         while i &lt; 8:
             if best_run_length &gt;= 2 and i == best_run_start:
                 // Insert :: for compressed zeros
                 parts.append("" if i == 0 else ":")
                 parts.append("")
                 i += best_run_length
             else:
                 parts.append(format_hex(words[i]))
                 i += 1

         return join(parts, ":")
</pre><a href="#section-9.4-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="deterministic-encryption-ipcrypt-deterministic">
<section id="section-9.5">
        <h3 id="name-deterministic-encryption-ip">
<a href="#section-9.5" class="section-number selfRef">9.5. </a><a href="#name-deterministic-encryption-ip" class="section-name selfRef">Deterministic Encryption (ipcrypt-deterministic)</a>
        </h3>
<div id="encryption">
<section id="section-9.5.1">
          <h4 id="name-encryption">
<a href="#section-9.5.1" class="section-number selfRef">9.5.1. </a><a href="#name-encryption" class="section-name selfRef">Encryption</a>
          </h4>
<div class="lang-pseudocode sourcecode" id="section-9.5.1-1">
<pre>
function ipcrypt_deterministic_encrypt(ip_address, key):
    // The key MUST be exactly 16 bytes (128 bits) in length
    if length(key) != 16:
        raise Error("Key must be 16 bytes")

    bytes16 = convert_to_16_bytes(ip_address)
    ciphertext = AES128_encrypt(key, bytes16)
    encrypted_ip = bytes_16_to_ip(ciphertext)
    return encrypted_ip
</pre><a href="#section-9.5.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="decryption">
<section id="section-9.5.2">
          <h4 id="name-decryption">
<a href="#section-9.5.2" class="section-number selfRef">9.5.2. </a><a href="#name-decryption" class="section-name selfRef">Decryption</a>
          </h4>
<div class="lang-pseudocode sourcecode" id="section-9.5.2-1">
<pre>
function ipcrypt_deterministic_decrypt(encrypted_ip, key):
    if length(key) != 16:
        raise Error("Key must be 16 bytes")

    bytes16 = convert_to_16_bytes(encrypted_ip)
    plaintext = AES128_decrypt(key, bytes16)
    original_ip = bytes_16_to_ip(plaintext)
    return original_ip
</pre><a href="#section-9.5.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="prefix-preserving-encryption-ipcrypt-pfx">
<section id="section-9.6">
        <h3 id="name-prefix-preserving-encryption-">
<a href="#section-9.6" class="section-number selfRef">9.6. </a><a href="#name-prefix-preserving-encryption-" class="section-name selfRef">Prefix-Preserving Encryption (ipcrypt-pfx)</a>
        </h3>
<div id="encryption-1">
<section id="section-9.6.1">
          <h4 id="name-encryption-2">
<a href="#section-9.6.1" class="section-number selfRef">9.6.1. </a><a href="#name-encryption-2" class="section-name selfRef">Encryption</a>
          </h4>
<div class="breakable lang-pseudocode sourcecode" id="section-9.6.1-1">
<pre>
function ipcrypt_pfx_encrypt(ip_address, key):
    // The key MUST be exactly 32 bytes (256 bits)
    if length(key) != 32:
        raise Error("Key must be 32 bytes")

    // Convert IP to 16-byte representation
    bytes16 = convert_to_16_bytes(ip_address)

    // Split the key into two AES-128 keys
    // IMPORTANT: K1 and K2 MUST be different
    K1 = key[0:16]
    K2 = key[16:32]

    // Initialize encrypted result with zeros
    encrypted = [0] * 16

    // If we encrypt an IPv4 address, start where the IPv4 address starts (bit 96)
    // Note the first 12 bytes of bytes16 are already set to the prefix for IPv4 mapping in that case
    // This provides domain separation between an IPv4 address and the first 32 bits of an IPv6 address
    if is_ipv4_mapped(bytes16):
        prefix_start = 96
        // Set up the IPv4-mapped IPv6 prefix
        encrypted[10] = 0xFF
        encrypted[11] = 0xFF
    else:
        prefix_start = 0

    // Initialize padded_prefix for the starting prefix length
    padded_prefix = pad_prefix(bytes16, prefix_start)

    // Process each bit position sequentially
    // Note: prefix_len_bits represents how many bits from the MSB have been processed
    // Range is [prefix_start, 128), i.e., up to but not including 128
    for prefix_len_bits from prefix_start to 128:
        // Compute pseudorandom function with dual AES encryption
        e1 = AES128_encrypt(K1, padded_prefix)
        e2 = AES128_encrypt(K2, padded_prefix)
        e = e1 ⊕ e2
        // Output of the pseudorandom function is the least significant bit of e
        cipher_bit = get_bit(e, 0)

        // Encrypt the current bit position (processing from MSB to LSB)
        // For IPv6: prefix_len_bits=0 encrypts bit 127, prefix_len_bits=1 encrypts bit 126, etc.
        // For IPv4: prefix_len_bits=96 encrypts bit 31, prefix_len_bits=97 encrypts bit 30, etc.
        bit_pos = 127 - prefix_len_bits
        original_bit = get_bit(bytes16, bit_pos)
        set_bit(encrypted, bit_pos, cipher_bit ^ original_bit)

        // Prepare padded_prefix for next iteration
        // Shift left by 1 bit and insert the next bit from bytes16
        padded_prefix = shift_left_one_bit(padded_prefix)
        set_bit(padded_prefix, 0, original_bit)

    // Convert back to IP format
    return bytes_16_to_ip(encrypted)
</pre><a href="#section-9.6.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="decryption-1">
<section id="section-9.6.2">
          <h4 id="name-decryption-2">
<a href="#section-9.6.2" class="section-number selfRef">9.6.2. </a><a href="#name-decryption-2" class="section-name selfRef">Decryption</a>
          </h4>
<div class="breakable lang-pseudocode sourcecode" id="section-9.6.2-1">
<pre>
function ipcrypt_pfx_decrypt(encrypted_ip, key):
    // The key MUST be exactly 32 bytes (256 bits)
    if length(key) != 32:
        raise Error("Key must be 32 bytes")

    // Convert encrypted IP to 16-byte representation
    encrypted_bytes = convert_to_16_bytes(encrypted_ip)

    // Split the key into two AES-128 keys
    K1 = key[0:16]
    K2 = key[16:32]

    // Initialize decrypted result with zeros
    decrypted = [0] * 16

    // If we decrypt an IPv4 address, start where the IPv4 address starts (bit 96)
    if is_ipv4_mapped(encrypted_bytes):
        prefix_start = 96
        // Set up the IPv4-mapped IPv6 prefix
        decrypted[10] = 0xFF
        decrypted[11] = 0xFF
    else:
        prefix_start = 0

    // Initialize padded_prefix for the starting prefix length
    padded_prefix = pad_prefix(decrypted, prefix_start)

    // Process each bit position sequentially
    // Note: prefix_len_bits represents how many bits from the MSB have been processed
    // Range is [prefix_start, 128), i.e., up to but not including 128
    for prefix_len_bits from prefix_start to 128:
        // Compute pseudorandom function with dual AES encryption
        e1 = AES128_encrypt(K1, padded_prefix)
        e2 = AES128_encrypt(K2, padded_prefix)
        // e is expected to be the same as during encryption since the prefix is the same
        e = e1 ⊕ e2
        // Output of the pseudorandom function is the least significant bit of e
        cipher_bit = get_bit(e, 0)

        // Decrypt the current bit position (processing from MSB to LSB)
        // For IPv6: prefix_len_bits=0 decrypts bit 127, prefix_len_bits=1 decrypts bit 126, etc.
        // For IPv4: prefix_len_bits=96 decrypts bit 31, prefix_len_bits=97 decrypts bit 30, etc.
        bit_pos = 127 - prefix_len_bits
        encrypted_bit = get_bit(encrypted_bytes, bit_pos)
        original_bit = cipher_bit ^ encrypted_bit
        set_bit(decrypted, bit_pos, original_bit)

        // Prepare padded_prefix for next iteration
        // Shift left by 1 bit and insert the next bit from decrypted
        padded_prefix = shift_left_one_bit(padded_prefix)
        set_bit(padded_prefix, 0, original_bit)

    // Convert back to IP format
    return bytes_16_to_ip(decrypted)
</pre><a href="#section-9.6.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="helper-functions">
<section id="section-9.6.3">
          <h4 id="name-helper-functions">
<a href="#section-9.6.3" class="section-number selfRef">9.6.3. </a><a href="#name-helper-functions" class="section-name selfRef">Helper Functions</a>
          </h4>
<p id="section-9.6.3-1">The following helper functions are used in the <code>ipcrypt-pfx</code> implementation:<a href="#section-9.6.3-1" class="pilcrow">¶</a></p>
<div class="breakable lang-pseudocode sourcecode" id="section-9.6.3-2">
<pre>
function is_ipv4_mapped(bytes16):
    // Returns true if the 16-byte array has the IPv4-mapped IPv6 prefix (::ffff:0:0/96)
    ipv4_mapped_prefix = [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF]
    return bytes16[0..12] == ipv4_mapped_prefix

function get_bit(data, position):
    // Extract bit at position from 16-byte array representing an IPv6 address in network byte order
    // position: 0 = LSB of byte 15, 127 = MSB of byte 0
    // Example: position 127 refers to bit 7 (MSB) of data[0]
    // Example: position 0 refers to bit 0 (LSB) of data[15]
    byte_index = 15 - (position / 8)
    bit_index = position % 8
    return (data[byte_index] &gt;&gt; bit_index) &amp; 1

function set_bit(data, position, value):
    // Set bit at position in 16-byte array representing an IPv6 address in network byte order
    // position: 0 = LSB of byte 15, 127 = MSB of byte 0
    byte_index = 15 - (position / 8)
    bit_index = position % 8
    data[byte_index] |= ((value &amp; 1) &lt;&lt; bit_index)

function pad_prefix(data, prefix_len_bits):
    // Specialized for the only two cases used: 0 and 96
    // For prefix_len_bits=0: Returns a block with only bit 0 set (position 0 = LSB of byte 15)
    // For prefix_len_bits=96: Returns the IPv4-mapped prefix with separator at position 96

    if prefix_len_bits == 0:
        // For IPv6 addresses starting from bit 0
        padded_prefix = [0] * 16
        padded_prefix[15] = 0x01  // Set bit at position 0 (LSB of byte 15)
        return padded_prefix

    else if prefix_len_bits == 96:
        // For IPv4 addresses, always returns the same value since all IPv4 addresses
        // share the same IPv4-mapped prefix (00...00 ffff)
        padded_prefix = [0] * 16
        padded_prefix[3] = 0x01   // Set separator bit at position 96 (bit 0 of byte 3)
        padded_prefix[14] = 0xFF  // IPv4-mapped prefix
        padded_prefix[15] = 0xFF  // IPv4-mapped prefix
        return padded_prefix

    else:
        raise Error("pad_prefix only supports prefix_len_bits of 0 or 96")

function shift_left_one_bit(data):
    // Shift a 16-byte array one bit to the left
    // The most significant bit is lost, and a zero bit is shifted in from the right
    result = [0] * 16
    carry = 0

    // Process from least significant byte (byte 15) to most significant byte (byte 0)
    for i from 15 down to 0:
        // Current byte shifted left by 1, with carry from previous byte
        result[i] = ((data[i] &lt;&lt; 1) | carry) &amp; 0xFF
        // Extract the bit that will be carried to the next byte
        carry = (data[i] &gt;&gt; 7) &amp; 1

    return result
</pre><a href="#section-9.6.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="non-deterministic-encryption-using-kiasu-bc-ipcrypt-nd">
<section id="section-9.7">
        <h3 id="name-non-deterministic-encryption-u">
<a href="#section-9.7" class="section-number selfRef">9.7. </a><a href="#name-non-deterministic-encryption-u" class="section-name selfRef">Non-Deterministic Encryption using KIASU-BC (ipcrypt-nd)</a>
        </h3>
<div id="encryption-2">
<section id="section-9.7.1">
          <h4 id="name-encryption-3">
<a href="#section-9.7.1" class="section-number selfRef">9.7.1. </a><a href="#name-encryption-3" class="section-name selfRef">Encryption</a>
          </h4>
<div class="lang-pseudocode sourcecode" id="section-9.7.1-1">
<pre>
function ipcrypt_nd_encrypt(ip_address, key):
    if length(key) != 16:
        raise Error("Key must be 16 bytes")

    // Step 1: Generate random tweak (8 bytes)
    tweak = random_bytes(8)  // MUST be uniformly random

    // Step 2: Convert IP to 16-byte representation
    bytes16 = convert_to_16_bytes(ip_address)

    // Step 3: Encrypt using key and tweak
    ciphertext = KIASU_BC_encrypt(key, tweak, bytes16)

    // Step 4: Concatenate tweak and ciphertext
    result = concatenate(tweak, ciphertext)  // 8 bytes || 16 bytes = 24 bytes total
    return result
</pre><a href="#section-9.7.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="decryption-2">
<section id="section-9.7.2">
          <h4 id="name-decryption-3">
<a href="#section-9.7.2" class="section-number selfRef">9.7.2. </a><a href="#name-decryption-3" class="section-name selfRef">Decryption</a>
          </h4>
<div class="lang-pseudocode sourcecode" id="section-9.7.2-1">
<pre>
function ipcrypt_nd_decrypt(ciphertext, key):
    // Step 1: Split ciphertext into tweak and encrypted IP
    tweak = ciphertext[0:8]  // First 8 bytes
    encrypted_ip = ciphertext[8:24]  // Remaining 16 bytes

    // Step 2: Decrypt using key and tweak
    bytes16 = KIASU_BC_decrypt(key, tweak, encrypted_ip)

    // Step 3: Convert back to IP address
    ip_address = bytes_16_to_ip(bytes16)
    return ip_address
</pre><a href="#section-9.7.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="non-deterministic-encryption-using-aes-xts-ipcrypt-ndx">
<section id="section-9.8">
        <h3 id="name-non-deterministic-encryption-us">
<a href="#section-9.8" class="section-number selfRef">9.8. </a><a href="#name-non-deterministic-encryption-us" class="section-name selfRef">Non-Deterministic Encryption using AES-XTS (ipcrypt-ndx)</a>
        </h3>
<div id="encryption-3">
<section id="section-9.8.1">
          <h4 id="name-encryption-4">
<a href="#section-9.8.1" class="section-number selfRef">9.8.1. </a><a href="#name-encryption-4" class="section-name selfRef">Encryption</a>
          </h4>
<div class="lang-pseudocode sourcecode" id="section-9.8.1-1">
<pre>
function ipcrypt_ndx_encrypt(ip_address, key):
    if length(key) != 32:
        raise Error("Key must be 32 bytes (two AES-128 keys)")

    // Step 1: Generate random tweak (16 bytes)
    tweak = random_bytes(16)  // MUST be uniformly random

    // Step 2: Convert IP to 16-byte representation
    bytes16 = convert_to_16_bytes(ip_address)

    // Step 3: Encrypt using key and tweak
    ciphertext = AES_XTS_encrypt(key, tweak, bytes16)

    // Step 4: Concatenate tweak and ciphertext
    result = concatenate(tweak, ciphertext)  // 16 bytes || 16 bytes = 32 bytes total
    return result
</pre><a href="#section-9.8.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="decryption-3">
<section id="section-9.8.2">
          <h4 id="name-decryption-4">
<a href="#section-9.8.2" class="section-number selfRef">9.8.2. </a><a href="#name-decryption-4" class="section-name selfRef">Decryption</a>
          </h4>
<div class="lang-pseudocode sourcecode" id="section-9.8.2-1">
<pre>
function ipcrypt_ndx_decrypt(ciphertext, key):
    // Step 1: Split ciphertext into tweak and encrypted IP
    tweak = ciphertext[0:16]  // First 16 bytes
    encrypted_ip = ciphertext[16:32]  // Remaining 16 bytes

    // Step 2: Decrypt using key and tweak
    bytes16 = AES_XTS_decrypt(key, tweak, encrypted_ip)

    // Step 3: Convert back to IP address
    ip_address = bytes_16_to_ip(bytes16)
    return ip_address
</pre><a href="#section-9.8.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="helper-functions-for-aes-xts">
<section id="section-9.8.3">
          <h4 id="name-helper-functions-for-aes-xt">
<a href="#section-9.8.3" class="section-number selfRef">9.8.3. </a><a href="#name-helper-functions-for-aes-xt" class="section-name selfRef">Helper Functions for AES-XTS</a>
          </h4>
<div class="lang-pseudocode sourcecode" id="section-9.8.3-1">
<pre>
function AES_XTS_encrypt(key, tweak, block):
    // Split the key into two halves
    K1, K2 = split_key(key)

    // Encrypt the tweak with the second half of the key
    ET = AES128_encrypt(K2, tweak)

    // Encrypt the block: AES128(block ⊕ ET, K1) ⊕ ET
    return AES128_encrypt(K1, block ⊕ ET) ⊕ ET

function AES_XTS_decrypt(key, tweak, block):
    // Split the key into two halves
    K1, K2 = split_key(key)

    // Encrypt the tweak with the second half of the key
    ET = AES128_encrypt(K2, tweak)

    // Decrypt the block: AES128_decrypt(block ⊕ ET, K1) ⊕ ET
    return AES128_decrypt(K1, block ⊕ ET) ⊕ ET
</pre><a href="#section-9.8.3-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="implementing-kiasu-bc">
<section id="section-9.9">
        <h3 id="name-kiasu-bc-implementation-gui">
<a href="#section-9.9" class="section-number selfRef">9.9. </a><a href="#name-kiasu-bc-implementation-gui" class="section-name selfRef">KIASU-BC Implementation Guide</a>
        </h3>
<p id="section-9.9-1">This section provides a guide for implementing the KIASU-BC tweakable block cipher used in <code>ipcrypt-nd</code>.<a href="#section-9.9-1" class="pilcrow">¶</a></p>
<div id="overview">
<section id="section-9.9.1">
          <h4 id="name-overview">
<a href="#section-9.9.1" class="section-number selfRef">9.9.1. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
          </h4>
<p id="section-9.9.1-1">KIASU-BC extends AES-128 by incorporating an 8-byte tweak into each round. The tweak is padded to 16 bytes and XORed with the round key at each round.<a href="#section-9.9.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="tweak-padding">
<section id="section-9.9.2">
          <h4 id="name-tweak-padding">
<a href="#section-9.9.2" class="section-number selfRef">9.9.2. </a><a href="#name-tweak-padding" class="section-name selfRef">Tweak Padding</a>
          </h4>
<p id="section-9.9.2-1">The 8-byte tweak is padded to 16 bytes using the following method:<a href="#section-9.9.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-9.9.2-2">
<li id="section-9.9.2-2.1">
              <p id="section-9.9.2-2.1.1">Split the 8-byte tweak into four 2-byte pairs<a href="#section-9.9.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-9.9.2-2.2">
              <p id="section-9.9.2-2.2.1">Place each 2-byte pair at the start of each 4-byte group<a href="#section-9.9.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-9.9.2-2.3">
              <p id="section-9.9.2-2.3.1">Fill the remaining 2 bytes of each group with zeros<a href="#section-9.9.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-9.9.2-3">Example:<a href="#section-9.9.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9.9.2-4">
<pre>
8-byte tweak:    [T0 T1 T2 T3 T4 T5 T6 T7]
16-byte padded:  [T0 T1 00 00 T2 T3 00 00 T4 T5 00 00 T6 T7 00 00]
</pre><a href="#section-9.9.2-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="round-structure">
<section id="section-9.9.3">
          <h4 id="name-round-structure">
<a href="#section-9.9.3" class="section-number selfRef">9.9.3. </a><a href="#name-round-structure" class="section-name selfRef">Round Structure</a>
          </h4>
<p id="section-9.9.3-1">Each round of KIASU-BC consists of the following standard AES operations:<a href="#section-9.9.3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-9.9.3-2">
<li id="section-9.9.3-2.1">
              <p id="section-9.9.3-2.1.1">SubBytes: Apply the AES S-box to each byte of the state<a href="#section-9.9.3-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-9.9.3-2.2">
              <p id="section-9.9.3-2.2.1">ShiftRows: Rotate each row of the state matrix<a href="#section-9.9.3-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-9.9.3-2.3">
              <p id="section-9.9.3-2.3.1">MixColumns: Mix the columns of the state matrix (except in the final round)<a href="#section-9.9.3-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-9.9.3-2.4">
              <p id="section-9.9.3-2.4.1">AddRoundKey: XOR the state with the round key and padded tweak<a href="#section-9.9.3-2.4.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-9.9.3-3">Details about these operations are provided in <span>[<a href="#FIPS-197" class="cite xref">FIPS-197</a>]</span>.<a href="#section-9.9.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="key-schedule">
<section id="section-9.9.4">
          <h4 id="name-key-schedule">
<a href="#section-9.9.4" class="section-number selfRef">9.9.4. </a><a href="#name-key-schedule" class="section-name selfRef">Key Schedule</a>
          </h4>
<p id="section-9.9.4-1">The key schedule follows the standard AES-128 key expansion:<a href="#section-9.9.4-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-9.9.4-2">
<li id="section-9.9.4-2.1">
              <p id="section-9.9.4-2.1.1">The initial key is expanded into 11 round keys<a href="#section-9.9.4-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-9.9.4-2.2">
              <p id="section-9.9.4-2.2.1">Each round key is XORed with the padded tweak before use<a href="#section-9.9.4-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-9.9.4-2.3">
              <p id="section-9.9.4-2.3.1">The first round key is used in the initial AddRoundKey operation<a href="#section-9.9.4-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
<div id="implementation-steps">
<section id="section-9.9.5">
          <h4 id="name-implementation-steps">
<a href="#section-9.9.5" class="section-number selfRef">9.9.5. </a><a href="#name-implementation-steps" class="section-name selfRef">Implementation Steps</a>
          </h4>
<ol start="1" type="1" class="normal type-1" id="section-9.9.5-1">
<li id="section-9.9.5-1.1">
              <p id="section-9.9.5-1.1.1">Key Expansion:<a href="#section-9.9.5-1.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.9.5-1.1.2.1">
                  <p id="section-9.9.5-1.1.2.1.1">Expand the 16-byte key into 11 round keys using the standard AES key schedule<a href="#section-9.9.5-1.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-9.9.5-1.1.2.2">
                  <p id="section-9.9.5-1.1.2.2.1">Each round key is 16 bytes<a href="#section-9.9.5-1.1.2.2.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li id="section-9.9.5-1.2">
              <p id="section-9.9.5-1.2.1">Tweak Processing:<a href="#section-9.9.5-1.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.9.5-1.2.2.1">
                  <p id="section-9.9.5-1.2.2.1.1">Pad the 8-byte tweak to 16 bytes as described above<a href="#section-9.9.5-1.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-9.9.5-1.2.2.2">
                  <p id="section-9.9.5-1.2.2.2.1">XOR the padded tweak with each round key before use<a href="#section-9.9.5-1.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li id="section-9.9.5-1.3">
              <p id="section-9.9.5-1.3.1">Encryption Process:<a href="#section-9.9.5-1.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.9.5-1.3.2.1">
                  <p id="section-9.9.5-1.3.2.1.1">Perform initial AddRoundKey with the first tweaked round key<a href="#section-9.9.5-1.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-9.9.5-1.3.2.2">
                  <p id="section-9.9.5-1.3.2.2.1">For rounds 1-9:<a href="#section-9.9.5-1.3.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.9.5-1.3.2.2.2.1">
                      <p id="section-9.9.5-1.3.2.2.2.1.1">SubBytes<a href="#section-9.9.5-1.3.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-9.9.5-1.3.2.2.2.2">
                      <p id="section-9.9.5-1.3.2.2.2.2.1">ShiftRows<a href="#section-9.9.5-1.3.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-9.9.5-1.3.2.2.2.3">
                      <p id="section-9.9.5-1.3.2.2.2.3.1">MixColumns<a href="#section-9.9.5-1.3.2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-9.9.5-1.3.2.2.2.4">
                      <p id="section-9.9.5-1.3.2.2.2.4.1">AddRoundKey (with tweaked round key)<a href="#section-9.9.5-1.3.2.2.2.4.1" class="pilcrow">¶</a></p>
</li>
                  </ul>
</li>
                <li class="normal" id="section-9.9.5-1.3.2.3">
                  <p id="section-9.9.5-1.3.2.3.1">For round 10 (final round):<a href="#section-9.9.5-1.3.2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.9.5-1.3.2.3.2.1">
                      <p id="section-9.9.5-1.3.2.3.2.1.1">SubBytes<a href="#section-9.9.5-1.3.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-9.9.5-1.3.2.3.2.2">
                      <p id="section-9.9.5-1.3.2.3.2.2.1">ShiftRows<a href="#section-9.9.5-1.3.2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-9.9.5-1.3.2.3.2.3">
                      <p id="section-9.9.5-1.3.2.3.2.3.1">AddRoundKey (with tweaked round key)<a href="#section-9.9.5-1.3.2.3.2.3.1" class="pilcrow">¶</a></p>
</li>
                  </ul>
</li>
              </ul>
</li>
          </ol>
</section>
</div>
<div id="example-implementation">
<section id="section-9.9.6">
          <h4 id="name-example-implementation">
<a href="#section-9.9.6" class="section-number selfRef">9.9.6. </a><a href="#name-example-implementation" class="section-name selfRef">Example Implementation</a>
          </h4>
<p id="section-9.9.6-1">The following pseudocode illustrates the core operations of KIASU-BC:<a href="#section-9.9.6-1" class="pilcrow">¶</a></p>
<div class="lang-pseudocode sourcecode" id="section-9.9.6-2">
<pre>
function pad_tweak(tweak):
    // Input: 8-byte tweak
    // Output: 16-byte padded tweak
    padded = [0] * 16
    for i in range(0, 4):
        padded[i*4]   = tweak[i*2]
        padded[i*4+1] = tweak[i*2+1]
    return padded

function kiasu_bc_encrypt(key, tweak, plaintext):
    // Input: 16-byte key, 8-byte tweak, 16-byte plaintext
    // Output: 16-byte ciphertext

    // Expand key and pad tweak
    round_keys = expand_key(key)
    padded_tweak = pad_tweak(tweak)

    // Initial round
    state = plaintext
    state = add_round_key(state, round_keys[0] ^ padded_tweak)

    // Main rounds
    for round in range(1, 10):
        state = sub_bytes(state)
        state = shift_rows(state)
        state = mix_columns(state)
        state = add_round_key(state, round_keys[round] ^ padded_tweak)

    // Final round
    state = sub_bytes(state)
    state = shift_rows(state)
    state = add_round_key(state, round_keys[10] ^ padded_tweak)

    return state
</pre><a href="#section-9.9.6-2" class="pilcrow">¶</a>
</div>
<p id="section-9.9.6-3">Key and tweak sizes for each variant:<a href="#section-9.9.6-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.9.6-4.1">
              <p id="section-9.9.6-4.1.1"><code>ipcrypt-deterministic</code>: Key: 16 bytes (128 bits), no tweak, Output: 16 bytes<a href="#section-9.9.6-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-9.9.6-4.2">
              <p id="section-9.9.6-4.2.1"><code>ipcrypt-pfx</code>: Key: 32 bytes (256 bits, split into two independent AES-128 keys), no external tweak (uses prefix as cryptographic context), Output: 4 bytes for IPv4, 16 bytes for IPv6<a href="#section-9.9.6-4.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-9.9.6-4.3">
              <p id="section-9.9.6-4.3.1"><code>ipcrypt-nd</code>: Key: 16 bytes (128 bits), Tweak: 8 bytes (64 bits), Output: 24 bytes<a href="#section-9.9.6-4.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-9.9.6-4.4">
              <p id="section-9.9.6-4.4.1"><code>ipcrypt-ndx</code>: Key: 32 bytes (256 bits, split into two AES-128 keys), Tweak: 16 bytes (128 bits), Output: 32 bytes<a href="#section-9.9.6-4.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="implementation-status">
<section id="section-10">
      <h2 id="name-implementation-status">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-implementation-status" class="section-name selfRef">Implementation Status</a>
      </h2>
<p id="section-10-1"><em>This section is to be removed before publishing as an RFC.</em><a href="#section-10-1" class="pilcrow">¶</a></p>
<p id="section-10-2">This section records the status of known implementations of the protocol defined by this specification at the time of posting of this Internet-Draft, and is based on a proposal described in <span>[<a href="#RFC7942" class="cite xref">RFC7942</a>]</span>.<a href="#section-10-2" class="pilcrow">¶</a></p>
<p id="section-10-3">Multiple independent, interoperable implementations have been developed and include Awk, C, D, Dart, Elixir, Go, Java, JavaScript, Kotlin, PHP, Python, Ruby, Rust, Swift, and Zig.<a href="#section-10-3" class="pilcrow">¶</a></p>
<p id="section-10-4">A comprehensive list of implementations and their test results is available at: https://ipcrypt-std.github.io/implementations/<a href="#section-10-4" class="pilcrow">¶</a></p>
<p id="section-10-5">All implementations pass the common test vectors specified in this document, demonstrating interoperability across programming languages.<a href="#section-10-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="licensing">
<section id="section-11">
      <h2 id="name-licensing">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-licensing" class="section-name selfRef">Licensing</a>
      </h2>
<p id="section-11-1"><em>This section is to be removed before publishing as an RFC.</em><a href="#section-11-1" class="pilcrow">¶</a></p>
<p id="section-11-2">Implementations of the ipcrypt methods are freely available under permissive open source licenses (MIT, BSD, or Apache 2.0) at the repository listed in the Implementation Status section.<a href="#section-11-2" class="pilcrow">¶</a></p>
<p id="section-11-3">There are no known patent claims on these methods.<a href="#section-11-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-combined-references">
<section id="section-12">
      <h2 id="name-references">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-12.1">
        <h3 id="name-normative-references">
<a href="#section-12.1" class="section-number selfRef">12.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="FIPS-197">[FIPS-197]</dt>
        <dd>
<span class="refAuthor">NIST</span>, <span class="refTitle">"Advanced Encryption Standard (AES)"</span>, <span class="seriesInfo">FIPS PUB 197</span>, <time datetime="2001-11-26" class="refDate">26 November 2001</time>, <span>&lt;<a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.197.pdf">https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.197.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NIST-SP-800-38G">[NIST-SP-800-38G]</dt>
        <dd>
<span class="refAuthor">NIST</span>, <span class="refTitle">"Recommendation for Block Cipher Modes of Operation: Methods for Format-Preserving Encryption"</span>, <span class="seriesInfo">NIST SP 800-38G</span>, <time datetime="2016-03" class="refDate">March 2016</time>, <span>&lt;<a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-38G.pdf">https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-38G.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4086">[RFC4086]</dt>
        <dd>
<span class="refAuthor">Eastlake 3rd, D.</span>, <span class="refAuthor">Schiller, J.</span>, and <span class="refAuthor">S. Crocker</span>, <span class="refTitle">"Randomness Requirements for Security"</span>, <span class="seriesInfo">BCP 106</span>, <span class="seriesInfo">RFC 4086</span>, <span class="seriesInfo">DOI 10.17487/RFC4086</span>, <time datetime="2005-06" class="refDate">June 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4086">https://www.rfc-editor.org/rfc/rfc4086</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4291">[RFC4291]</dt>
        <dd>
<span class="refAuthor">Hinden, R.</span> and <span class="refAuthor">S. Deering</span>, <span class="refTitle">"IP Version 6 Addressing Architecture"</span>, <span class="seriesInfo">RFC 4291</span>, <span class="seriesInfo">DOI 10.17487/RFC4291</span>, <time datetime="2006-02" class="refDate">February 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4291">https://www.rfc-editor.org/rfc/rfc4291</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5952">[RFC5952]</dt>
        <dd>
<span class="refAuthor">Kawamura, S.</span> and <span class="refAuthor">M. Kawashima</span>, <span class="refTitle">"A Recommendation for IPv6 Address Text Representation"</span>, <span class="seriesInfo">RFC 5952</span>, <span class="seriesInfo">DOI 10.17487/RFC5952</span>, <time datetime="2010-08" class="refDate">August 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5952">https://www.rfc-editor.org/rfc/rfc5952</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6973">[RFC6973]</dt>
        <dd>
<span class="refAuthor">Cooper, A.</span>, <span class="refAuthor">Tschofenig, H.</span>, <span class="refAuthor">Aboba, B.</span>, <span class="refAuthor">Peterson, J.</span>, <span class="refAuthor">Morris, J.</span>, <span class="refAuthor">Hansen, M.</span>, and <span class="refAuthor">R. Smith</span>, <span class="refTitle">"Privacy Considerations for Internet Protocols"</span>, <span class="seriesInfo">RFC 6973</span>, <span class="seriesInfo">DOI 10.17487/RFC6973</span>, <time datetime="2013-07" class="refDate">July 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6973">https://www.rfc-editor.org/rfc/rfc6973</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7258">[RFC7258]</dt>
        <dd>
<span class="refAuthor">Farrell, S.</span> and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Pervasive Monitoring Is an Attack"</span>, <span class="seriesInfo">BCP 188</span>, <span class="seriesInfo">RFC 7258</span>, <span class="seriesInfo">DOI 10.17487/RFC7258</span>, <time datetime="2014-05" class="refDate">May 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7258">https://www.rfc-editor.org/rfc/rfc7258</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7624">[RFC7624]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Schneier, B.</span>, <span class="refAuthor">Jennings, C.</span>, <span class="refAuthor">Hardie, T.</span>, <span class="refAuthor">Trammell, B.</span>, <span class="refAuthor">Huitema, C.</span>, and <span class="refAuthor">D. Borkmann</span>, <span class="refTitle">"Confidentiality in the Face of Pervasive Surveillance: A Threat Model and Problem Statement"</span>, <span class="seriesInfo">RFC 7624</span>, <span class="seriesInfo">DOI 10.17487/RFC7624</span>, <time datetime="2015-08" class="refDate">August 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7624">https://www.rfc-editor.org/rfc/rfc7624</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7942">[RFC7942]</dt>
        <dd>
<span class="refAuthor">Sheffer, Y.</span> and <span class="refAuthor">A. Farrel</span>, <span class="refTitle">"Improving Awareness of Running Code: The Implementation Status Section"</span>, <span class="seriesInfo">BCP 205</span>, <span class="seriesInfo">RFC 7942</span>, <span class="seriesInfo">DOI 10.17487/RFC7942</span>, <time datetime="2016-07" class="refDate">July 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7942">https://www.rfc-editor.org/rfc/rfc7942</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-12.2">
        <h3 id="name-informative-references">
<a href="#section-12.2" class="section-number selfRef">12.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="BRW2005">[BRW2005]</dt>
        <dd>
<span class="refAuthor">Black, J.</span> and <span class="refAuthor">P. Rogaway</span>, <span class="refTitle">"Format-Preserving Encryption"</span>, <span class="seriesInfo">CRYPTO 2005</span>, <time datetime="2005" class="refDate">2005</time>, <span>&lt;<a href="https://www.cs.ucdavis.edu/~rogaway/papers/subset.pdf">https://www.cs.ucdavis.edu/~rogaway/papers/subset.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="DEOXYS-BC">[DEOXYS-BC]</dt>
        <dd>
<span class="refAuthor">Jean, J.</span>, <span class="refAuthor">Nikolić, I.</span>, and <span class="refAuthor">T. Peyrin</span>, <span class="refTitle">"Deoxys-BC: A Highly Secure Tweakable Block Cipher"</span>, <span class="seriesInfo">Cryptology ePrint Archive Paper 2014/427</span>, <time datetime="2014" class="refDate">2014</time>, <span>&lt;<a href="https://competitions.cr.yp.to/round3/deoxysv14.pdf">https://competitions.cr.yp.to/round3/deoxysv14.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="FAST">[FAST]</dt>
        <dd>
<span class="refAuthor">Betul Durak, F.</span>, <span class="refAuthor">Horst, H.</span>, and <span class="refAuthor">S. Vaudenay</span>, <span class="refTitle">"FAST: Format-Preserving Encryption via Shortened AES Tweakable Block Cipher"</span>, <span class="seriesInfo">Cryptology ePrint Archive Report 2021/1171</span>, <time datetime="2021-09-12" class="refDate">12 September 2021</time>, <span>&lt;<a href="https://eprint.iacr.org/2021/1171.pdf">https://eprint.iacr.org/2021/1171.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IEEE-P1619">[IEEE-P1619]</dt>
        <dd>
<span class="refAuthor">IEEE</span>, <span class="refTitle">"IEEE Standard for Cryptographic Protection of Data on Block-Oriented Storage Devices"</span>, <span class="seriesInfo">IEEE 1619-2007</span>, <time datetime="2007-12-18" class="refDate">18 December 2007</time>, <span>&lt;<a href="https://ieeexplore.ieee.org/document/4493450">https://ieeexplore.ieee.org/document/4493450</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="KIASU-BC">[KIASU-BC]</dt>
        <dd>
<span class="refAuthor">Jean, J.</span>, <span class="refAuthor">Nikolić, I.</span>, and <span class="refAuthor">T. Peyrin</span>, <span class="refTitle">"Tweaks and Keys for Block Ciphers: the TWEAKEY Framework"</span>, <span class="seriesInfo">Cryptology ePrint Archive Paper 2014/831</span>, <time datetime="2014" class="refDate">2014</time>, <span>&lt;<a href="https://eprint.iacr.org/2014/831.pdf">https://eprint.iacr.org/2014/831.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="LRW2002">[LRW2002]</dt>
        <dd>
<span class="refAuthor">Liskov, M.</span>, <span class="refAuthor">Rivest, R.</span>, and <span class="refAuthor">D. Wagner</span>, <span class="refTitle">"Tweakable Block Ciphers"</span>, <span class="seriesInfo">Fast Software Encryption 2002</span>, <time datetime="2002" class="refDate">2002</time>, <span>&lt;<a href="https://people.csail.mit.edu/rivest/pubs/LRW02.pdf">https://people.csail.mit.edu/rivest/pubs/LRW02.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="REVISITING-SUM">[REVISITING-SUM]</dt>
        <dd>
<span class="refAuthor">Gunsing, A.</span>, <span class="refAuthor">Bhaumik, R.</span>, <span class="refAuthor">Jha, A.</span>, <span class="refAuthor">Mennink, B.</span>, and <span class="refAuthor">Y. Shen</span>, <span class="refTitle">"Revisiting the Indifferentiability of the Sum of Permutations"</span>, <time datetime="2023" class="refDate">2023</time>, <span>&lt;<a href="https://eprint.iacr.org/2023/840.pdf">https://eprint.iacr.org/2023/840.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RSSAC040">[RSSAC040]</dt>
        <dd>
<span class="refAuthor">ICANN RSSAC</span>, <span class="refTitle">"RSSAC040: Recommendations on Anonymization Processes for Source IP Addresses Submitted for Future Analysis"</span>, <time datetime="2021-03-09" class="refDate">9 March 2021</time>, <span>&lt;<a href="https://www.icann.org/en/system/files/files/rssac-040-07aug18-en.pdf">https://www.icann.org/en/system/files/files/rssac-040-07aug18-en.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SKINNY">[SKINNY]</dt>
        <dd>
<span class="refAuthor">Beierle, C.</span>, <span class="refAuthor">Jean, J.</span>, <span class="refAuthor">Koelbl, S.</span>, <span class="refAuthor">Leander, G.</span>, <span class="refAuthor">Moradi, A.</span>, <span class="refAuthor">Peyrin, T.</span>, <span class="refAuthor">Sasaki, Y.</span>, <span class="refAuthor">Sasdrich, P.</span>, and <span class="refAuthor">S. Meng Sim</span>, <span class="refTitle">"The SKINNY Family of Block Ciphers and its Low-Latency Variant MANTIS"</span>, <span class="seriesInfo">CRYPTO 2016</span>, <time datetime="2016" class="refDate">2016</time>, <span>&lt;<a href="https://eprint.iacr.org/2016/660.pdf">https://eprint.iacr.org/2016/660.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SUM-OF-PRPS">[SUM-OF-PRPS]</dt>
        <dd>
<span class="refAuthor">Lucks, S.</span>, <span class="refTitle">"The Sum of PRPs Is a Secure PRF"</span>, <span class="seriesInfo">EUROCRYPT 2000</span>, <time datetime="2000" class="refDate">2000</time>, <span>&lt;<a href="https://link.springer.com/content/pdf/10.1007/3-540-45539-6_34.pdf">https://link.springer.com/content/pdf/10.1007/3-540-45539-6_34.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="XTS-AES">[XTS-AES]</dt>
      <dd>
<span class="refTitle">"The XTS-AES Mode for Disk Encryption"</span>, <span class="seriesInfo">IEEE 1619-2007</span>, <time datetime="2008" class="refDate">2008</time>, <span>&lt;<a href="https://ieeexplore.ieee.org/document/4493450">https://ieeexplore.ieee.org/document/4493450</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="test-vectors">
<section id="appendix-A">
      <h2 id="name-test-vectors">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-test-vectors" class="section-name selfRef">Test Vectors</a>
      </h2>
<p id="appendix-A-1">This appendix provides test vectors for the ipcrypt variants. Each test vector includes the key, input IP address, and encrypted output. Non-deterministic variants include the tweak value.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">Implementations MUST verify their correctness against these test vectors before deployment.<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<div id="ipcrypt-deterministic-test-vectors">
<section id="appendix-A.1">
        <h3 id="name-ipcrypt-deterministic-test-">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-ipcrypt-deterministic-test-" class="section-name selfRef">ipcrypt-deterministic Test Vectors</a>
        </h3>
<div class="lang-test-vectors sourcecode" id="appendix-A.1-1">
<pre>
# Test vector 1
Key:          0123456789abcdeffedcba9876543210
Input IP:     0.0.0.0
Encrypted IP: bde9:6789:d353:824c:d7c6:f58a:6bd2:26eb

# Test vector 2
Key:          1032547698badcfeefcdab8967452301
Input IP:     255.255.255.255
Encrypted IP: aed2:92f6:ea23:58c3:48fd:8b8:74e8:45d8

# Test vector 3
Key:          2b7e151628aed2a6abf7158809cf4f3c
Input IP:     192.0.2.1
Encrypted IP: 1dbd:c1b9:fff1:7586:7d0b:67b4:e76e:4777
</pre><a href="#appendix-A.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="ipcrypt-pfx-test-vectors">
<section id="appendix-A.2">
        <h3 id="name-ipcrypt-pfx-test-vectors">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-ipcrypt-pfx-test-vectors" class="section-name selfRef">ipcrypt-pfx Test Vectors</a>
        </h3>
<p id="appendix-A.2-1">The following test vectors demonstrate the prefix-preserving property of ipcrypt-pfx. Addresses from the same network produce encrypted addresses that share a common encrypted prefix.<a href="#appendix-A.2-1" class="pilcrow">¶</a></p>
<div id="basic-test-vectors">
<section id="appendix-A.2.1">
          <h4 id="name-basic-test-vectors">
<a href="#appendix-A.2.1" class="section-number selfRef">A.2.1. </a><a href="#name-basic-test-vectors" class="section-name selfRef">Basic Test Vectors</a>
          </h4>
<div class="lang-test-vectors sourcecode" id="appendix-A.2.1-1">
<pre>
# Test vector 1 (IPv4)
Key:          0123456789abcdeffedcba98765432101032547698badcfeefcdab8967452301
Input IP:     0.0.0.0
Encrypted IP: 151.82.155.134

# Test vector 2 (IPv4)
Key:          0123456789abcdeffedcba98765432101032547698badcfeefcdab8967452301
Input IP:     255.255.255.255
Encrypted IP: 94.185.169.89

# Test vector 3 (IPv4)
Key:          0123456789abcdeffedcba98765432101032547698badcfeefcdab8967452301
Input IP:     192.0.2.1
Encrypted IP: 100.115.72.131

# Test vector 4 (IPv6)
Key:          0123456789abcdeffedcba98765432101032547698badcfeefcdab8967452301
Input IP:     2001:db8::1
Encrypted IP: c180:5dd4:2587:3524:30ab:fa65:6ab6:f88
</pre><a href="#appendix-A.2.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="prefix-preserving-test-vectors">
<section id="appendix-A.2.2">
          <h4 id="name-prefix-preserving-test-vect">
<a href="#appendix-A.2.2" class="section-number selfRef">A.2.2. </a><a href="#name-prefix-preserving-test-vect" class="section-name selfRef">Prefix-Preserving Test Vectors</a>
          </h4>
<p id="appendix-A.2.2-1">These test vectors demonstrate the prefix-preserving property. Addresses from the same network share common encrypted prefixes at the corresponding prefix length.<a href="#appendix-A.2.2-1" class="pilcrow">¶</a></p>
<div class="breakable lang-test-vectors sourcecode" id="appendix-A.2.2-2">
<pre>
# IPv4 addresses from same /24 network (10.0.0.0/24)
Key:          2b7e151628aed2a6abf7158809cf4f3ca9f5ba40db214c3798f2e1c23456789a
Input IP:     10.0.0.47
Encrypted IP: 19.214.210.244

Key:          2b7e151628aed2a6abf7158809cf4f3ca9f5ba40db214c3798f2e1c23456789a
Input IP:     10.0.0.129
Encrypted IP: 19.214.210.80

Key:          2b7e151628aed2a6abf7158809cf4f3ca9f5ba40db214c3798f2e1c23456789a
Input IP:     10.0.0.234
Encrypted IP: 19.214.210.30

# IPv4 addresses from same /16 but different /24 networks
Key:          2b7e151628aed2a6abf7158809cf4f3ca9f5ba40db214c3798f2e1c23456789a
Input IP:     172.16.5.193
Encrypted IP: 210.78.229.136

Key:          2b7e151628aed2a6abf7158809cf4f3ca9f5ba40db214c3798f2e1c23456789a
Input IP:     172.16.97.42
Encrypted IP: 210.78.179.241

Key:          2b7e151628aed2a6abf7158809cf4f3ca9f5ba40db214c3798f2e1c23456789a
Input IP:     172.16.248.177
Encrypted IP: 210.78.121.215

# IPv6 addresses from same /64 network (2001:db8::/64)
Key:          2b7e151628aed2a6abf7158809cf4f3ca9f5ba40db214c3798f2e1c23456789a
Input IP:     2001:db8::a5c9:4e2f:bb91:5a7d
Encrypted IP: 7cec:702c:1243:f70:1956:125:b9bd:1aba

Key:          2b7e151628aed2a6abf7158809cf4f3ca9f5ba40db214c3798f2e1c23456789a
Input IP:     2001:db8::7234:d8f1:3c6e:9a52
Encrypted IP: 7cec:702c:1243:f70:a3ef:c8e:95c1:cd0d

Key:          2b7e151628aed2a6abf7158809cf4f3ca9f5ba40db214c3798f2e1c23456789a
Input IP:     2001:db8::f1e0:937b:26d4:8c1a
Encrypted IP: 7cec:702c:1243:f70:443c:c8e:6a62:b64d

# IPv6 addresses from same /32 but different /48 networks
Key:          2b7e151628aed2a6abf7158809cf4f3ca9f5ba40db214c3798f2e1c23456789a
Input IP:     2001:db8:3a5c:0:e7d1:4b9f:2c8a:f673
Encrypted IP: 7cec:702c:3503:bef:e616:96bd:be33:a9b9

Key:          2b7e151628aed2a6abf7158809cf4f3ca9f5ba40db214c3798f2e1c23456789a
Input IP:     2001:db8:9f27:0:b4e2:7a3d:5f91:c8e6
Encrypted IP: 7cec:702c:a504:b74e:194a:3d90:b047:2d1a

Key:          2b7e151628aed2a6abf7158809cf4f3ca9f5ba40db214c3798f2e1c23456789a
Input IP:     2001:db8:d8b4:0:193c:a5e7:8b2f:46d1
Encrypted IP: 7cec:702c:f840:aa67:1b8:e84f:ac9d:77fb
</pre><a href="#appendix-A.2.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="ipcrypt-nd-test-vectors">
<section id="appendix-A.3">
        <h3 id="name-ipcrypt-nd-test-vectors">
<a href="#appendix-A.3" class="section-number selfRef">A.3. </a><a href="#name-ipcrypt-nd-test-vectors" class="section-name selfRef">ipcrypt-nd Test Vectors</a>
        </h3>
<div class="lang-test-vectors sourcecode" id="appendix-A.3-1">
<pre>
# Test vector 1
Key:          0123456789abcdeffedcba9876543210
Input IP:     0.0.0.0
Tweak:        08e0c289bff23b7c
Output:       08e0c289bff23b7cb349aadfe3bcef56221c384c7c217b16

# Test vector 2
Key:          1032547698badcfeefcdab8967452301
Input IP:     192.0.2.1
Tweak:        21bd1834bc088cd2
Output:       21bd1834bc088cd2e5e1fe55f95876e639faae2594a0caad

# Test vector 3
Key:          2b7e151628aed2a6abf7158809cf4f3c
Input IP:     2001:db8::1
Tweak:        b4ecbe30b70898d7
Output:       b4ecbe30b70898d7553ac8974d1b4250eafc4b0aa1f80c96
</pre><a href="#appendix-A.3-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="ipcrypt-ndx-test-vectors">
<section id="appendix-A.4">
        <h3 id="name-ipcrypt-ndx-test-vectors">
<a href="#appendix-A.4" class="section-number selfRef">A.4. </a><a href="#name-ipcrypt-ndx-test-vectors" class="section-name selfRef">ipcrypt-ndx Test Vectors</a>
        </h3>
<div class="lang-test-vectors sourcecode" id="appendix-A.4-1">
<pre>
# Test vector 1
Key:          0123456789abcdeffedcba98765432101032547698badcfeefcdab8967452301
Input IP:     0.0.0.0
Tweak:        21bd1834bc088cd2b4ecbe30b70898d7
Output:       21bd1834bc088cd2b4ecbe30b70898d782db0d4125fdace61db35b8339f20ee5

# Test vector 2
Key:          1032547698badcfeefcdab89674523010123456789abcdeffedcba9876543210
Input IP:     192.0.2.1
Tweak:        08e0c289bff23b7cb4ecbe30b70898d7
Output:       08e0c289bff23b7cb4ecbe30b70898d7766a533392a69edf1ad0d3ce362ba98a

# Test vector 3
Key:          2b7e151628aed2a6abf7158809cf4f3c3c4fcf098815f7aba6d2ae2816157e2b
Input IP:     2001:db8::1
Tweak:        21bd1834bc088cd2b4ecbe30b70898d7
Output:       21bd1834bc088cd2b4ecbe30b70898d76089c7e05ae30c2d10ca149870a263e4
</pre><a href="#appendix-A.4-1" class="pilcrow">¶</a>
</div>
<p id="appendix-A.4-2">For non-deterministic variants, the tweak values shown are examples. Tweaks MUST be uniformly random for each encryption operation.<a href="#appendix-A.4-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="appendix-B">
      <h2 id="name-iana-considerations">
<a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="appendix-B-1">This document does not require any IANA actions.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-C">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-C-1">We would like to thank the members of the IETF and the cryptographic community for their helpful comments on this work. Tobias Fiebig conducted a detailed review of this draft. Additional valuable feedback was provided by Eliot Lear. Assistance with implementation aspects was kindly provided by Wu Tingfeng.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-D">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Frank Denis</span></div>
<div dir="auto" class="left"><span class="org">Fastly Inc.</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:fde@00f.net" class="email">fde@00f.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
