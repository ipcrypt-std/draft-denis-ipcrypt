<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Methods for IP Address Encryption and Obfuscation</title>
<meta content="Frank Denis" name="author">
<meta content="
       This document specifies methods for encrypting and obfuscating IP addresses, providing both deterministic format-preserving and non-deterministic constructions. These methods address privacy concerns raised in   and   regarding pervasive monitoring and data collection. 
       The methods apply uniformly to both IPv4 and IPv6 addresses by converting them into a 16-byte representation. Two generic constructions are defined—one using a 128-bit block cipher and the other using a 128-bit tweakable block cipher—along with three concrete instantiations: 
       
         
           ipcrypt-deterministic :  Deterministic encryption using AES-128 as a single-block operation. 
         
         
           ipcrypt-nd :  Non-deterministic encryption using the KIASU-BC tweakable block cipher with an 8-byte tweak. 
         
         
           ipcrypt-ndx :  Non-deterministic encryption using the AES-XTS tweakable block cipher with a 16-byte tweak. 
         
       
       Deterministic mode produces a 16-byte ciphertext enabling format preservation. Non-deterministic modes prepend a randomly sampled tweak to produce larger ciphertexts that resist correlation attacks. When generated, tweaks MUST be uniformly random as specified in  . 
    " name="description">
<meta content="xml2rfc 3.30.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-denis-ipcrypt-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.30.0
    Python 3.12.11
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.6
    lxml 5.3.1
    platformdirs 4.3.8
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.4
    setuptools 80.9.0
    wcwidth 0.2.13
-->
<link href="draft-denis-ipcrypt.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">ipcrypt</td>
<td class="right">July 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Denis</td>
<td class="center">Expires 22 January 2026</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-denis-ipcrypt-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-07-21" class="published">21 July 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2026-01-22">22 January 2026</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">F. Denis</div>
<div class="org">Fastly Inc.</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Methods for IP Address Encryption and Obfuscation</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies methods for encrypting and obfuscating IP addresses, providing both deterministic format-preserving and non-deterministic constructions. These methods address privacy concerns raised in <span>[<a href="#RFC6973" class="cite xref">RFC6973</a>]</span> and <span>[<a href="#RFC7258" class="cite xref">RFC7258</a>]</span> regarding pervasive monitoring and data collection.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2">The methods apply uniformly to both IPv4 and IPv6 addresses by converting them into a 16-byte representation. Two generic constructions are defined—one using a 128-bit block cipher and the other using a 128-bit tweakable block cipher—along with three concrete instantiations:<a href="#section-abstract-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-abstract-3.1">
          <p id="section-abstract-3.1.1"><strong><code>ipcrypt-deterministic</code>:</strong> Deterministic encryption using AES-128 as a single-block operation.<a href="#section-abstract-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-abstract-3.2">
          <p id="section-abstract-3.2.1"><strong><code>ipcrypt-nd</code>:</strong> Non-deterministic encryption using the KIASU-BC tweakable block cipher with an 8-byte tweak.<a href="#section-abstract-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-abstract-3.3">
          <p id="section-abstract-3.3.1"><strong><code>ipcrypt-ndx</code>:</strong> Non-deterministic encryption using the AES-XTS tweakable block cipher with a 16-byte tweak.<a href="#section-abstract-3.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-abstract-4">Deterministic mode produces a 16-byte ciphertext enabling format preservation. Non-deterministic modes prepend a randomly sampled tweak to produce larger ciphertexts that resist correlation attacks. When generated, tweaks MUST be uniformly random as specified in <span>[<a href="#RFC4086" class="cite xref">RFC4086</a>]</span>.<a href="#section-abstract-4" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Source for this draft and an issue tracker can be found at
    <span><a href="https://github.com/jedisct1/draft-denis-ipcrypt">https://github.com/jedisct1/draft-denis-ipcrypt</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 22 January 2026.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-use-cases-and-motivations" class="internal xref">Use Cases and Motivations</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-ip-address-conversion" class="internal xref">IP Address Conversion</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-converting-to-a-16byte-repr" class="internal xref">Converting to a 16‑Byte Representation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1"><a href="#section-3.1.1" class="auto internal xref">3.1.1</a>.  <a href="#name-ipv6-addresses" class="internal xref">IPv6 Addresses</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.2">
                    <p id="section-toc.1-1.3.2.1.2.2.1"><a href="#section-3.1.2" class="auto internal xref">3.1.2</a>.  <a href="#name-ipv4-addresses" class="internal xref">IPv4 Addresses</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-converting-from-a-16-byte-r" class="internal xref">Converting from a 16-Byte Representation to an IP Address</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-generic-constructions" class="internal xref">Generic Constructions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-deterministic-encryption" class="internal xref">Deterministic Encryption</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-ipcrypt-deterministic" class="internal xref">ipcrypt-deterministic</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-format-preservation" class="internal xref">Format Preservation</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-non-deterministic-encryptio" class="internal xref">Non-Deterministic Encryption</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-encryption-process" class="internal xref">Encryption Process</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-decryption-process" class="internal xref">Decryption Process</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="auto internal xref">6.3</a>.  <a href="#name-output-format-and-encoding" class="internal xref">Output Format and Encoding</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="auto internal xref">6.4</a>.  <a href="#name-concrete-instantiations" class="internal xref">Concrete Instantiations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4.2.1">
                    <p id="section-toc.1-1.6.2.4.2.1.1"><a href="#section-6.4.1" class="auto internal xref">6.4.1</a>.  <a href="#name-ipcrypt-nd-kiasu-bc" class="internal xref">ipcrypt-nd (KIASU-BC)</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4.2.2">
                    <p id="section-toc.1-1.6.2.4.2.2.1"><a href="#section-6.4.2" class="auto internal xref">6.4.2</a>.  <a href="#name-ipcrypt-ndx-aes-xts" class="internal xref">ipcrypt-ndx (AES-XTS)</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4.2.3">
                    <p id="section-toc.1-1.6.2.4.2.3.1"><a href="#section-6.4.3" class="auto internal xref">6.4.3</a>.  <a href="#name-comparison-of-modes" class="internal xref">Comparison of Modes</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-deterministic-mode-security" class="internal xref">Deterministic Mode Security</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-non-deterministic-mode-secu" class="internal xref">Non-Deterministic Mode Security</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-implementation-security" class="internal xref">Implementation Security</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-implementation-status" class="internal xref">Implementation Status</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="auto internal xref">10.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="auto internal xref">10.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-diagrams" class="internal xref">Diagrams</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#appendix-A.1" class="auto internal xref">A.1</a>.  <a href="#name-ipv4-address-conversion-dia" class="internal xref">IPv4 Address Conversion Diagram</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#appendix-A.2" class="auto internal xref">A.2</a>.  <a href="#name-deterministic-encryption-fl" class="internal xref">Deterministic Encryption Flow</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.3">
                <p id="section-toc.1-1.11.2.3.1"><a href="#appendix-A.3" class="auto internal xref">A.3</a>.  <a href="#name-nondeterministic-encryption" class="internal xref">Non‑Deterministic Encryption Flow (ipcrypt-nd)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.4">
                <p id="section-toc.1-1.11.2.4.1"><a href="#appendix-A.4" class="auto internal xref">A.4</a>.  <a href="#name-nondeterministic-encryption-" class="internal xref">Non‑Deterministic Encryption Flow (ipcrypt-ndx)</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-pseudocode-and-examples" class="internal xref">Pseudocode and Examples</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#appendix-B.1" class="auto internal xref">B.1</a>.  <a href="#name-ipv4-address-conversion" class="internal xref">IPv4 Address Conversion</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#appendix-B.2" class="auto internal xref">B.2</a>.  <a href="#name-ipv6-address-conversion" class="internal xref">IPv6 Address Conversion</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.3">
                <p id="section-toc.1-1.12.2.3.1"><a href="#appendix-B.3" class="auto internal xref">B.3</a>.  <a href="#name-conversion-from-a-16-byte-a" class="internal xref">Conversion from a 16-Byte Array to an IP Address</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.4">
                <p id="section-toc.1-1.12.2.4.1"><a href="#appendix-B.4" class="auto internal xref">B.4</a>.  <a href="#name-deterministic-encryption-ip" class="internal xref">Deterministic Encryption (ipcrypt-deterministic)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.5">
                <p id="section-toc.1-1.12.2.5.1"><a href="#appendix-B.5" class="auto internal xref">B.5</a>.  <a href="#name-non-deterministic-encryption" class="internal xref">Non-Deterministic Encryption using KIASU-BC (ipcrypt-nd)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.6">
                <p id="section-toc.1-1.12.2.6.1"><a href="#appendix-B.6" class="auto internal xref">B.6</a>.  <a href="#name-non-deterministic-encryption-" class="internal xref">Non-Deterministic Encryption using AES-XTS (ipcrypt-ndx)</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-C" class="auto internal xref">Appendix C</a>.  <a href="#name-implementing-kiasu-bc" class="internal xref">Implementing KIASU-BC</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#appendix-C.1" class="auto internal xref">C.1</a>.  <a href="#name-overview" class="internal xref">Overview</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#appendix-C.2" class="auto internal xref">C.2</a>.  <a href="#name-tweak-padding" class="internal xref">Tweak Padding</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.3">
                <p id="section-toc.1-1.13.2.3.1"><a href="#appendix-C.3" class="auto internal xref">C.3</a>.  <a href="#name-round-structure" class="internal xref">Round Structure</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.4">
                <p id="section-toc.1-1.13.2.4.1"><a href="#appendix-C.4" class="auto internal xref">C.4</a>.  <a href="#name-key-schedule" class="internal xref">Key Schedule</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.5">
                <p id="section-toc.1-1.13.2.5.1"><a href="#appendix-C.5" class="auto internal xref">C.5</a>.  <a href="#name-implementation-steps" class="internal xref">Implementation Steps</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.6">
                <p id="section-toc.1-1.13.2.6.1"><a href="#appendix-C.6" class="auto internal xref">C.6</a>.  <a href="#name-example-implementation" class="internal xref">Example Implementation</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-D" class="auto internal xref">Appendix D</a>.  <a href="#name-test-vectors" class="internal xref">Test Vectors</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.1">
                <p id="section-toc.1-1.14.2.1.1"><a href="#appendix-D.1" class="auto internal xref">D.1</a>.  <a href="#name-ipcrypt-deterministic-test-" class="internal xref">ipcrypt-deterministic Test Vectors</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2">
                <p id="section-toc.1-1.14.2.2.1"><a href="#appendix-D.2" class="auto internal xref">D.2</a>.  <a href="#name-ipcrypt-nd-test-vectors" class="internal xref">ipcrypt-nd Test Vectors</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3">
                <p id="section-toc.1-1.14.2.3.1"><a href="#appendix-D.3" class="auto internal xref">D.3</a>.  <a href="#name-ipcrypt-ndx-test-vectors" class="internal xref">ipcrypt-ndx Test Vectors</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#appendix-E" class="auto internal xref">Appendix E</a>.  <a href="#name-alternatives-to-random-twea" class="internal xref">Alternatives to Random Tweaks</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#appendix-F" class="auto internal xref">Appendix F</a>.  <a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#appendix-G" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This document specifies methods for the encryption and obfuscation of IP addresses for both operational use and privacy preservation. The objective is to enable network operators, researchers, and privacy advocates to share or analyze data while protecting sensitive address information.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">This work addresses concerns raised in <span>[<a href="#RFC7624" class="cite xref">RFC7624</a>]</span> regarding confidentiality in the face of pervasive surveillance. The security properties of these methods are discussed throughout this document and summarized in <a href="#security-considerations" class="auto internal xref">Section 7</a>.<a href="#section-1-2" class="pilcrow">¶</a></p>
<div id="use-cases-and-motivations">
<section id="section-1.1">
        <h3 id="name-use-cases-and-motivations">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-use-cases-and-motivations" class="section-name selfRef">Use Cases and Motivations</a>
        </h3>
<p id="section-1.1-1">The main motivations include:<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-2.1">
            <p id="section-1.1-2.1.1"><strong>Privacy Protection:</strong> Encrypting IP addresses prevents the disclosure of user-specific information when data is logged or measured, as discussed in <span>[<a href="#RFC6973" class="cite xref">RFC6973</a>]</span>.<a href="#section-1.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-2.2">
            <p id="section-1.1-2.2.1"><strong>Format Preservation:</strong> Ensuring that the encrypted output remains a valid IP address allows network devices to process the data without modification. See <a href="#format-preservation" class="auto internal xref">Section 5.2</a> for details.<a href="#section-1.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-2.3">
            <p id="section-1.1-2.3.1"><strong>Mitigation of Correlation Attacks:</strong> Deterministic encryption reveals repeated inputs; non-deterministic modes use a random tweak to obscure linkability while keeping the underlying input confidential. See <a href="#non-deterministic-encryption" class="auto internal xref">Section 6</a> for implementation details.<a href="#section-1.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-2.4">
            <p id="section-1.1-2.4.1"><strong>Privacy-Preserving Analytics:</strong> Many common operations like counting unique clients or implementing rate limiting can be performed using encrypted IP addresses without ever accessing the original values. This enables privacy-preserving analytics while maintaining functionality.<a href="#section-1.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-2.5">
            <p id="section-1.1-2.5.1"><strong>Third-Party Service Integration:</strong> IP addresses are private information that should not be sent in cleartext to potentially untrusted third-party services or cloud providers. Using encrypted IP addresses as keys or identifiers allows integration with external services while protecting user privacy.<a href="#section-1.1-2.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-3">For implementation examples, see <a href="#pseudocode-and-examples" class="auto internal xref">Appendix B</a>.<a href="#section-1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="terminology">
<section id="section-2">
      <h2 id="name-terminology">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
      </h2>
<p id="section-2-1">The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in BCP 14 <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">Throughout this document, the following terms and conventions apply:<a href="#section-2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-3.1">
          <p id="section-2-3.1.1"><strong>IP Address:</strong> An IPv4 or IPv6 address as defined in <span>[<a href="#RFC4291" class="cite xref">RFC4291</a>]</span>.<a href="#section-2-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.2">
          <p id="section-2-3.2.1"><strong>16-Byte Representation:</strong> A fixed-length representation used for both IPv4 (via IPv4-mapped IPv6) and IPv6 addresses.<a href="#section-2-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.3">
          <p id="section-2-3.3.1"><strong>Tweak:</strong> A non‑secret, additional input to a tweakable block cipher that further randomizes the output.<a href="#section-2-3.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.4">
          <p id="section-2-3.4.1"><strong>Deterministic Encryption:</strong> Encryption that always produces the same ciphertext for a given input and key.<a href="#section-2-3.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.5">
          <p id="section-2-3.5.1"><strong>Non-Deterministic Encryption:</strong> Encryption that produces different ciphertexts for the same input due to the inclusion of a randomly sampled tweak.<a href="#section-2-3.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.6">
          <p id="section-2-3.6.1"><strong>(Input, Tweak) Collision:</strong> A scenario where the same input is encrypted with the same tweak. This reveals that the input was repeated but not the input’s value.<a href="#section-2-3.6.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="ip-address-conversion">
<section id="section-3">
      <h2 id="name-ip-address-conversion">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-ip-address-conversion" class="section-name selfRef">IP Address Conversion</a>
      </h2>
<p id="section-3-1">This section describes the conversion of IP addresses to and from a 16-byte representation. This conversion is necessary to operate a 128-bit cipher on both IPv4 and IPv6 addresses.<a href="#section-3-1" class="pilcrow">¶</a></p>
<div id="converting-to-a-16byte-representation">
<section id="section-3.1">
        <h3 id="name-converting-to-a-16byte-repr">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-converting-to-a-16byte-repr" class="section-name selfRef">Converting to a 16‑Byte Representation</a>
        </h3>
<div id="ipv6-addresses">
<section id="section-3.1.1">
          <h4 id="name-ipv6-addresses">
<a href="#section-3.1.1" class="section-number selfRef">3.1.1. </a><a href="#name-ipv6-addresses" class="section-name selfRef">IPv6 Addresses</a>
          </h4>
<p id="section-3.1.1-1">IPv6 addresses are natively 128 bits and are converted directly using network byte order (big-endian) as specified in <span>[<a href="#RFC4291" class="cite xref">RFC4291</a>]</span>.<a href="#section-3.1.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1.1-2"><em>Example:</em><a href="#section-3.1.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1.1-3">
<pre>
IPv6 Address:    2001:0db8:85a3:0000:0000:8a2e:0370:7334
16-Byte Representation: [20 01 0d b8 85 a3 00 00 00 00 8a 2e 03 70 73 34]
</pre><a href="#section-3.1.1-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="ipv4-addresses">
<section id="section-3.1.2">
          <h4 id="name-ipv4-addresses">
<a href="#section-3.1.2" class="section-number selfRef">3.1.2. </a><a href="#name-ipv4-addresses" class="section-name selfRef">IPv4 Addresses</a>
          </h4>
<p id="section-3.1.2-1">IPv4 addresses (32 bits) are mapped using the IPv4-mapped IPv6 format as specified in <span>[<a href="#RFC4291" class="cite xref">RFC4291</a>]</span>:<a href="#section-3.1.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1.2-2">
<pre>
IPv4 Address:    192.0.2.1
16-Byte Representation: [00 00 00 00 00 00 00 00 00 00 FF FF C0 00 02 01]
</pre><a href="#section-3.1.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="converting-from-a-16-byte-representation-to-an-ip-address">
<section id="section-3.2">
        <h3 id="name-converting-from-a-16-byte-r">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-converting-from-a-16-byte-r" class="section-name selfRef">Converting from a 16-Byte Representation to an IP Address</a>
        </h3>
<p id="section-3.2-1">The conversion algorithm is as follows:<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.2-2">
<li id="section-3.2-2.1">
            <p id="section-3.2-2.1.1">Examine the first 12 bytes of the 16-byte representation<a href="#section-3.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.2-2.2">
            <p id="section-3.2-2.2.1">If they match the IPv4-mapped prefix (10 bytes of 0x00 followed by 0xFF, 0xFF):<a href="#section-3.2-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-2.2.2.1">
                <p id="section-3.2-2.2.2.1.1">Interpret the last 4 bytes as an IPv4 address in dotted-decimal notation<a href="#section-3.2-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li id="section-3.2-2.3">
            <p id="section-3.2-2.3.1">Otherwise:<a href="#section-3.2-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-2.3.2.1">
                <p id="section-3.2-2.3.2.1.1">Interpret the 16 bytes as an IPv6 address in colon-hexadecimal notation<a href="#section-3.2-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ol>
</section>
</div>
</section>
</div>
<div id="generic-constructions">
<section id="section-4">
      <h2 id="name-generic-constructions">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-generic-constructions" class="section-name selfRef">Generic Constructions</a>
      </h2>
<p id="section-4-1">This specification defines two generic cryptographic constructions:<a href="#section-4-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4-2">
<li id="section-4-2.1">
          <p id="section-4-2.1.1"><strong>128-bit Block Cipher Construction:</strong><a href="#section-4-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.1.2.1">
              <p id="section-4-2.1.2.1.1">Used in deterministic encryption (see <a href="#deterministic-encryption" class="auto internal xref">Section 5</a>)<a href="#section-4-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.1.2.2">
              <p id="section-4-2.1.2.2.1">Operates on a single 16-byte block<a href="#section-4-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.1.2.3">
              <p id="section-4-2.1.2.3.1">Example: AES-128 treated as a permutation<a href="#section-4-2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
        <li id="section-4-2.2">
          <p id="section-4-2.2.1"><strong>128-bit Tweakable Block Cipher (TBC) Construction:</strong><a href="#section-4-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.2.2.1">
              <p id="section-4-2.2.2.1.1">Used in non-deterministic encryption (see <a href="#non-deterministic-encryption" class="auto internal xref">Section 6</a>)<a href="#section-4-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.2.2.2">
              <p id="section-4-2.2.2.2.1">Accepts a key, a tweak, and a message<a href="#section-4-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.2.2.3">
              <p id="section-4-2.2.2.3.1">The tweak must be uniformly random when generated<a href="#section-4-2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4-2.2.2.4">
              <p id="section-4-2.2.2.4.1">Reuse of the same tweak on different inputs does not compromise confidentiality<a href="#section-4-2.2.2.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
      </ol>
<p id="section-4-3">Valid options for implementing a tweakable block cipher include, but are not limited to:<a href="#section-4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-4.1">
          <p id="section-4-4.1.1"><strong>SKINNY</strong> (see <span>[<a href="#SKINNY" class="cite xref">SKINNY</a>]</span>)<a href="#section-4-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-4.2">
          <p id="section-4-4.2.1"><strong>DEOXYS-BC</strong> (see <span>[<a href="#DEOXYS-BC" class="cite xref">DEOXYS-BC</a>]</span>)<a href="#section-4-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-4.3">
          <p id="section-4-4.3.1"><strong>KIASU-BC</strong> (see <a href="#implementing-kiasu-bc" class="auto internal xref">Appendix C</a> for implementation details)<a href="#section-4-4.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-4.4">
          <p id="section-4-4.4.1"><strong>AES-XTS</strong> (see <a href="#ipcrypt-ndx" class="auto internal xref">Section 6.4.2</a> for usage)<a href="#section-4-4.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-4-5">Implementers MUST choose a cipher that meets the required security properties and provides robust resistance against related-tweak and other cryptographic attacks.<a href="#section-4-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="deterministic-encryption">
<section id="section-5">
      <h2 id="name-deterministic-encryption">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-deterministic-encryption" class="section-name selfRef">Deterministic Encryption</a>
      </h2>
<p id="section-5-1">Deterministic encryption applies a 128-bit block cipher directly to the 16-byte representation of an IP address. All instantiations documented in this specification (<code>ipcrypt-deterministic</code>, <code>ipcrypt-nd</code>, and <code>ipcrypt-ndx</code>) are invertible - encrypted IP addresses can be decrypted back to their original values using the same key. For non-deterministic modes, the tweak must be preserved along with the ciphertext to enable decryption.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">For implementation details, see <a href="#pseudocode-and-examples" class="auto internal xref">Appendix B</a>.<a href="#section-5-2" class="pilcrow">¶</a></p>
<div id="ipcrypt-deterministic">
<section id="section-5.1">
        <h3 id="name-ipcrypt-deterministic">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-ipcrypt-deterministic" class="section-name selfRef">ipcrypt-deterministic</a>
        </h3>
<p id="section-5.1-1">The <code>ipcrypt-deterministic</code> instantiation employs AES-128 in a single-block operation. The key MUST be exactly 16 bytes (128 bits) in length. Since AES-128 is a permutation, every distinct 16-byte input maps to a unique 16-byte ciphertext, preserving the IP address format.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">For test vectors, see <a href="#ipcrypt-deterministic-test-vectors" class="auto internal xref">Appendix D.1</a>.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-3">
<pre>
      +---------------------+
      |      IP Address     |
      |    (IPv4 or IPv6)   |
      +---------------------+
                 |
                 v
      +---------------------+
      | Convert to 16 Bytes |
      +---------------------+
                 |
                 v
      +---------------------+
      |   AES128 Encrypt    |
      |   (Single Block)    |
      +---------------------+
                 |
                 v
      +---------------------+
      |    16-Byte Output   |
      +---------------------+
                 |
                 v
      +---------------------+
      | Convert to IP Format|
      +---------------------+
</pre><a href="#section-5.1-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="format-preservation">
<section id="section-5.2">
        <h3 id="name-format-preservation">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-format-preservation" class="section-name selfRef">Format Preservation</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-5.2-1.1">
            <p id="section-5.2-1.1.1">If the 16-byte ciphertext begins with an IPv4-mapped prefix, it MUST be rendered as a dotted-decimal IPv4 address.<a href="#section-5.2-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-1.2">
            <p id="section-5.2-1.2.1">Otherwise, it is interpreted as an IPv6 address.<a href="#section-5.2-1.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.2-2">To ensure IPv4 format preservation, implementers MUST consider using cycle-walking (repeatedly encrypting until a valid IPv4-mapped address is obtained), a 32-bit random permutation, or a Format-Preserving Encryption (FPE) mode as specified in <span>[<a href="#NIST-SP-800-38G" class="cite xref">NIST-SP-800-38G</a>]</span>.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="non-deterministic-encryption">
<section id="section-6">
      <h2 id="name-non-deterministic-encryptio">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-non-deterministic-encryptio" class="section-name selfRef">Non-Deterministic Encryption</a>
      </h2>
<p id="section-6-1">Non-deterministic encryption leverages a tweakable block cipher together with a random tweak. For implementation details, see <a href="#pseudocode-and-examples" class="auto internal xref">Appendix B</a>.<a href="#section-6-1" class="pilcrow">¶</a></p>
<div id="encryption-process">
<section id="section-6.1">
        <h3 id="name-encryption-process">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-encryption-process" class="section-name selfRef">Encryption Process</a>
        </h3>
<p id="section-6.1-1">The encryption process for non-deterministic modes consists of the following steps:<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.1-2">
<li id="section-6.1-2.1">
            <p id="section-6.1-2.1.1">Generate a random tweak using a cryptographically secure random number generator<a href="#section-6.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.1-2.2">
            <p id="section-6.1-2.2.1">Convert the IP address to its 16-byte representation<a href="#section-6.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.1-2.3">
            <p id="section-6.1-2.3.1">Encrypt the 16-byte representation using the key and the tweak<a href="#section-6.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.1-2.4">
            <p id="section-6.1-2.4.1">Concatenate the tweak with the encrypted output to form the final ciphertext<a href="#section-6.1-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-6.1-3">The tweak is not considered secret and is included in the ciphertext. This allows the same tweak to be used for decryption.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="decryption-process">
<section id="section-6.2">
        <h3 id="name-decryption-process">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-decryption-process" class="section-name selfRef">Decryption Process</a>
        </h3>
<p id="section-6.2-1">The decryption process consists of the following steps:<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.2-2">
<li id="section-6.2-2.1">
            <p id="section-6.2-2.1.1">Split the ciphertext into the tweak and the encrypted IP<a href="#section-6.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-2.2">
            <p id="section-6.2-2.2.1">Decrypt the encrypted IP using the key and the tweak<a href="#section-6.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-2.3">
            <p id="section-6.2-2.3.1">Convert the resulting 16-byte representation back to an IP address<a href="#section-6.2-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-6.2-3">Although the tweak is generated uniformly at random, occasional collisions may occur according to birthday bounds. Such collisions are benign when they occur with different inputs. An <code>(input, tweak)</code> collision reveals that the same input was encrypted with the same tweak but does not disclose the input’s value. The usage limits discussed below apply per cryptographic key; rotating keys can extend secure usage beyond these bounds.<a href="#section-6.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="output-format-and-encoding">
<section id="section-6.3">
        <h3 id="name-output-format-and-encoding">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-output-format-and-encoding" class="section-name selfRef">Output Format and Encoding</a>
        </h3>
<p id="section-6.3-1">The output of non-deterministic encryption is binary data. For applications that require text representation (e.g., logging, JSON encoding, or text-based protocols), the binary output MUST be encoded. Common encoding options include hexadecimal and Base64. The choice of encoding is application-specific and outside the scope of this specification. However, implementations SHOULD document their chosen encoding method clearly.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="concrete-instantiations">
<section id="section-6.4">
        <h3 id="name-concrete-instantiations">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-concrete-instantiations" class="section-name selfRef">Concrete Instantiations</a>
        </h3>
<p id="section-6.4-1">This document defines two concrete instantiations:<a href="#section-6.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.4-2.1">
            <p id="section-6.4-2.1.1"><strong><code>ipcrypt-nd</code>:</strong> Uses the KIASU-BC tweakable block cipher with an 8-byte (64-bit) tweak. See <span>[<a href="#KIASU-BC" class="cite xref">KIASU-BC</a>]</span> for details.<a href="#section-6.4-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.4-2.2">
            <p id="section-6.4-2.2.1"><strong><code>ipcrypt-ndx</code>:</strong> Uses the AES-XTS tweakable block cipher with a 16-byte (128-bit) tweak. See <span>[<a href="#XTS-AES" class="cite xref">XTS-AES</a>]</span> for background.<a href="#section-6.4-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-6.4-3">In both cases, if a tweak is generated randomly, it MUST be uniformly random. Reusing the same randomly generated tweak on different inputs is acceptable from a confidentiality standpoint.<a href="#section-6.4-3" class="pilcrow">¶</a></p>
<p id="section-6.4-4">For test vectors, see <a href="#ipcrypt-nd-test-vectors" class="auto internal xref">Appendix D.2</a> and <a href="#ipcrypt-ndx-test-vectors" class="auto internal xref">Appendix D.3</a>.<a href="#section-6.4-4" class="pilcrow">¶</a></p>
<div id="ipcrypt-nd">
<section id="section-6.4.1">
          <h4 id="name-ipcrypt-nd-kiasu-bc">
<a href="#section-6.4.1" class="section-number selfRef">6.4.1. </a><a href="#name-ipcrypt-nd-kiasu-bc" class="section-name selfRef">ipcrypt-nd (KIASU-BC)</a>
          </h4>
<p id="section-6.4.1-1">The <code>ipcrypt-nd</code> instantiation uses the KIASU-BC tweakable block cipher with an 8-byte (64-bit) tweak. For implementation details, see <a href="#implementing-kiasu-bc" class="auto internal xref">Appendix C</a>. The output is 24 bytes total, consisting of an 8-byte tweak concatenated with a 16-byte ciphertext.<a href="#section-6.4.1-1" class="pilcrow">¶</a></p>
<p id="section-6.4.1-2">Random sampling of an 8-byte tweak yields an expected collision for a specific tweak value after about 2^(64/2) = 2^32 operations (approximately 4 billion operations). If an <code>(input, tweak)</code> collision occurs, it indicates that the same input was processed with that tweak without revealing the input’s value.<a href="#section-6.4.1-2" class="pilcrow">¶</a></p>
<p id="section-6.4.1-3">These collision bounds apply per cryptographic key. By rotating keys regularly, secure usage can be extended well beyond these bounds. The effective security is determined by the underlying block cipher’s strength.<a href="#section-6.4.1-3" class="pilcrow">¶</a></p>
<p id="section-6.4.1-4">For test vectors, see <a href="#ipcrypt-nd-test-vectors" class="auto internal xref">Appendix D.2</a>.<a href="#section-6.4.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ipcrypt-ndx">
<section id="section-6.4.2">
          <h4 id="name-ipcrypt-ndx-aes-xts">
<a href="#section-6.4.2" class="section-number selfRef">6.4.2. </a><a href="#name-ipcrypt-ndx-aes-xts" class="section-name selfRef">ipcrypt-ndx (AES-XTS)</a>
          </h4>
<p id="section-6.4.2-1">The <code>ipcrypt-ndx</code> instantiation uses the AES-XTS tweakable block cipher with a 16-byte (128-bit) tweak. The output is 32 bytes total, consisting of a 16-byte tweak concatenated with a 16-byte ciphertext.<a href="#section-6.4.2-1" class="pilcrow">¶</a></p>
<p id="section-6.4.2-2">For AES-XTS encryption of a single block, the computation avoids the sequential tweak calculations required in full XTS mode. Independent sampling of a 16-byte tweak results in an expected collision after about 2^(128/2) = 2^64 operations (approximately 18 quintillion operations).<a href="#section-6.4.2-2" class="pilcrow">¶</a></p>
<p id="section-6.4.2-3">As with <code>ipcrypt-nd</code>, an <code>(input, tweak)</code> collision reveals repetition without compromising the input value. These limits are per key, and regular key rotation further extends secure usage. The effective security is governed by the strength of AES-128 (approximately 2^128 operations).<a href="#section-6.4.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="comparison-of-modes">
<section id="section-6.4.3">
          <h4 id="name-comparison-of-modes">
<a href="#section-6.4.3" class="section-number selfRef">6.4.3. </a><a href="#name-comparison-of-modes" class="section-name selfRef">Comparison of Modes</a>
          </h4>
<ul class="normal">
<li class="normal" id="section-6.4.3-1.1">
              <p id="section-6.4.3-1.1.1"><strong>Deterministic (<code>ipcrypt-deterministic</code>):</strong>
Produces a 16-byte output; preserves format but reveals repeated inputs.<a href="#section-6.4.3-1.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-6.4.3-1.2">
              <p id="section-6.4.3-1.2.1"><strong>Non-Deterministic:</strong><a href="#section-6.4.3-1.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.4.3-1.2.2.1">
                  <p id="section-6.4.3-1.2.2.1.1"><strong><code>ipcrypt-nd</code> (KIASU-BC):</strong> Produces a 24-byte output using an 8-byte tweak; <code>(input, tweak)</code> collisions reveal repeated inputs (with the same tweak) but not their values. Expected collision after approximately 4 billion operations per key.<a href="#section-6.4.3-1.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-6.4.3-1.2.2.2">
                  <p id="section-6.4.3-1.2.2.2.1"><strong><code>ipcrypt-ndx</code> (AES-XTS):</strong> Produces a 32-byte output using a 16-byte tweak; supports higher secure operation counts per key. Expected collision after approximately 18 quintillion operations per key.<a href="#section-6.4.3-1.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
          </ul>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-7-1">The ipcrypt constructions focus solely on confidentiality and do not provide integrity. This means that IP addresses in an ordered sequence can be partially removed, duplicated, reordered, or blindly altered by an active adversary. Applications that require sequences of encrypted IP addresses that cannot be modified must apply an authentication scheme over the entire sequence, such as an HMAC construction, a keyed hash function, or a public key signature. This is outside the scope of this specification, but implementers should be aware that additional authentication mechanisms are required if protection against active adversaries is needed.<a href="#section-7-1" class="pilcrow">¶</a></p>
<div id="deterministic-mode-security">
<section id="section-7.1">
        <h3 id="name-deterministic-mode-security">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-deterministic-mode-security" class="section-name selfRef">Deterministic Mode Security</a>
        </h3>
<p id="section-7.1-1">A permutation ensures distinct inputs yield distinct outputs. However, repeated inputs result in identical ciphertexts, thereby revealing repetition.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">This property makes deterministic encryption suitable for applications where format preservation is required, but linkability of repeated inputs is acceptable.<a href="#section-7.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="non-deterministic-mode-security">
<section id="section-7.2">
        <h3 id="name-non-deterministic-mode-secu">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-non-deterministic-mode-secu" class="section-name selfRef">Non-Deterministic Mode Security</a>
        </h3>
<p id="section-7.2-1">The inclusion of a random tweak ensures that encrypting the same input generally produces different outputs. In cases where an <code>(input, tweak)</code> collision occurs, an attacker learns only that the same input was processed with that tweak, not the value of the input itself.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2-2">Security is determined by the underlying block cipher (≈2^128 for AES-128) on a per-key basis. Key rotation is recommended to extend secure usage beyond the per-key collision bounds.<a href="#section-7.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="implementation-security">
<section id="section-7.3">
        <h3 id="name-implementation-security">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-implementation-security" class="section-name selfRef">Implementation Security</a>
        </h3>
<p id="section-7.3-1">Implementations MUST ensure that:<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.3-2">
<li id="section-7.3-2.1">
            <p id="section-7.3-2.1.1">Keys are generated using a cryptographically secure random number generator<a href="#section-7.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.3-2.2">
            <p id="section-7.3-2.2.1">Tweak values are uniformly random for non-deterministic modes<a href="#section-7.3-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.3-2.3">
            <p id="section-7.3-2.3.1">Side-channel attacks are mitigated through constant-time operations<a href="#section-7.3-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.3-2.4">
            <p id="section-7.3-2.4.1">Error handling does not leak sensitive information<a href="#section-7.3-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ol>
</section>
</div>
</section>
</div>
<div id="implementation-status">
<section id="section-8">
      <h2 id="name-implementation-status">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-implementation-status" class="section-name selfRef">Implementation Status</a>
      </h2>
<p id="section-8-1"><em>This note is to be removed before publishing as an RFC.</em><a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">Multiple implementations of the schemes described in this document have been developed and verified for interoperability. A comprehensive list of known implementations and integrations can be found at https://github.com/ipcrypt-std/draft-denis-ipcrypt, which includes reference implementations closely aligned with the pseudocode provided in this document.<a href="#section-8-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-9">
      <h2 id="name-iana-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-9-1">This document does not require any IANA actions.<a href="#section-9-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-combined-references">
<section id="section-10">
      <h2 id="name-references">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-10.1">
        <h3 id="name-normative-references">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="FIPS-197">[FIPS-197]</dt>
        <dd>
<span class="refAuthor">NIST</span>, <span class="refTitle">"Advanced Encryption Standard (AES)"</span>, <span class="seriesInfo">FIPS PUB 197</span>, <time datetime="2001-11-26" class="refDate">26 November 2001</time>, <span>&lt;<a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.197.pdf">https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.197.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NIST-SP-800-38G">[NIST-SP-800-38G]</dt>
        <dd>
<span class="refAuthor">NIST</span>, <span class="refTitle">"Recommendation for Block Cipher Modes of Operation: Methods for Format-Preserving Encryption"</span>, <span class="seriesInfo">NIST SP 800-38G</span>, <time datetime="2016-03" class="refDate">March 2016</time>, <span>&lt;<a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-38G.pdf">https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-38G.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4086">[RFC4086]</dt>
        <dd>
<span class="refAuthor">Eastlake 3rd, D.</span>, <span class="refAuthor">Schiller, J.</span>, and <span class="refAuthor">S. Crocker</span>, <span class="refTitle">"Randomness Requirements for Security"</span>, <span class="seriesInfo">BCP 106</span>, <span class="seriesInfo">RFC 4086</span>, <span class="seriesInfo">DOI 10.17487/RFC4086</span>, <time datetime="2005-06" class="refDate">June 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4086">https://www.rfc-editor.org/rfc/rfc4086</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4291">[RFC4291]</dt>
        <dd>
<span class="refAuthor">Hinden, R.</span> and <span class="refAuthor">S. Deering</span>, <span class="refTitle">"IP Version 6 Addressing Architecture"</span>, <span class="seriesInfo">RFC 4291</span>, <span class="seriesInfo">DOI 10.17487/RFC4291</span>, <time datetime="2006-02" class="refDate">February 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4291">https://www.rfc-editor.org/rfc/rfc4291</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6973">[RFC6973]</dt>
        <dd>
<span class="refAuthor">Cooper, A.</span>, <span class="refAuthor">Tschofenig, H.</span>, <span class="refAuthor">Aboba, B.</span>, <span class="refAuthor">Peterson, J.</span>, <span class="refAuthor">Morris, J.</span>, <span class="refAuthor">Hansen, M.</span>, and <span class="refAuthor">R. Smith</span>, <span class="refTitle">"Privacy Considerations for Internet Protocols"</span>, <span class="seriesInfo">RFC 6973</span>, <span class="seriesInfo">DOI 10.17487/RFC6973</span>, <time datetime="2013-07" class="refDate">July 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6973">https://www.rfc-editor.org/rfc/rfc6973</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7258">[RFC7258]</dt>
        <dd>
<span class="refAuthor">Farrell, S.</span> and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Pervasive Monitoring Is an Attack"</span>, <span class="seriesInfo">BCP 188</span>, <span class="seriesInfo">RFC 7258</span>, <span class="seriesInfo">DOI 10.17487/RFC7258</span>, <time datetime="2014-05" class="refDate">May 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7258">https://www.rfc-editor.org/rfc/rfc7258</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7624">[RFC7624]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Schneier, B.</span>, <span class="refAuthor">Jennings, C.</span>, <span class="refAuthor">Hardie, T.</span>, <span class="refAuthor">Trammell, B.</span>, <span class="refAuthor">Huitema, C.</span>, and <span class="refAuthor">D. Borkmann</span>, <span class="refTitle">"Confidentiality in the Face of Pervasive Surveillance: A Threat Model and Problem Statement"</span>, <span class="seriesInfo">RFC 7624</span>, <span class="seriesInfo">DOI 10.17487/RFC7624</span>, <time datetime="2015-08" class="refDate">August 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7624">https://www.rfc-editor.org/rfc/rfc7624</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-10.2">
        <h3 id="name-informative-references">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="BRW2005">[BRW2005]</dt>
        <dd>
<span class="refAuthor">Bellare, M.</span>, <span class="refAuthor">Rogaway, P.</span>, and <span class="refAuthor">D. Wagner</span>, <span class="refTitle">"Format-Preserving Encryption"</span>, <span class="seriesInfo">CRYPTO 2005</span>, <time datetime="2005" class="refDate">2005</time>, <span>&lt;<a href="https://www.cs.ucdavis.edu/~rogaway/papers/subset.pdf">https://www.cs.ucdavis.edu/~rogaway/papers/subset.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="DEOXYS-BC">[DEOXYS-BC]</dt>
        <dd>
<span class="refAuthor">Jean, J.</span>, <span class="refAuthor">Nikolić, I.</span>, and <span class="refAuthor">T. Peyrin</span>, <span class="refTitle">"Deoxys-BC: A Highly Secure Tweakable Block Cipher"</span>, <span class="seriesInfo">Cryptology ePrint Archive Paper 2014/427</span>, <time datetime="2014" class="refDate">2014</time>, <span>&lt;<a href="https://eprint.iacr.org/2014/427">https://eprint.iacr.org/2014/427</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IEEE-P1619">[IEEE-P1619]</dt>
        <dd>
<span class="refAuthor">IEEE</span>, <span class="refTitle">"IEEE Standard for Cryptographic Protection of Data on Block-Oriented Storage Devices"</span>, <span class="seriesInfo">IEEE 1619-2007</span>, <time datetime="2007-12-18" class="refDate">18 December 2007</time>, <span>&lt;<a href="https://standards.ieee.org/ieee/1619/2041/">https://standards.ieee.org/ieee/1619/2041/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IPCRYPT2">[IPCRYPT2]</dt>
        <dd>
<span class="refAuthor">Denis, F.</span>, <span class="refTitle">"ipcrypt2: IP address encryption/obfuscation tool"</span>, <time datetime="2025" class="refDate">2025</time>, <span>&lt;<a href="https://github.com/jedisct1/ipcrypt2">https://github.com/jedisct1/ipcrypt2</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="KIASU-BC">[KIASU-BC]</dt>
        <dd>
<span class="refAuthor">Jean, J.</span>, <span class="refAuthor">Nikolić, I.</span>, and <span class="refAuthor">T. Peyrin</span>, <span class="refTitle">"Tweaks and Keys for Block Ciphers: the TWEAKEY Framework"</span>, <span class="seriesInfo">Cryptology ePrint Archive Paper 2014/831</span>, <time datetime="2014" class="refDate">2014</time>, <span>&lt;<a href="https://eprint.iacr.org/2014/831">https://eprint.iacr.org/2014/831</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="LRW2002">[LRW2002]</dt>
        <dd>
<span class="refAuthor">Liskov, M.</span>, <span class="refAuthor">Rivest, R.</span>, and <span class="refAuthor">D. Wagner</span>, <span class="refTitle">"Tweakable Block Ciphers"</span>, <span class="seriesInfo">Fast Software Encryption 2002</span>, <time datetime="2002" class="refDate">2002</time>, <span>&lt;<a href="https://www.cs.berkeley.edu/~daw/papers/tweak-crypto02.pdf">https://www.cs.berkeley.edu/~daw/papers/tweak-crypto02.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SKINNY">[SKINNY]</dt>
        <dd>
<span class="refAuthor">Beierle, C.</span>, <span class="refAuthor">Biryukov, A.</span>, <span class="refAuthor">Perrin, L.</span>, <span class="refAuthor">Udovenko, A.</span>, <span class="refAuthor">Velichkov, V.</span>, and <span class="refAuthor">Q. Wang</span>, <span class="refTitle">"The SKINNY Family of Block Ciphers and its Low-Latency Variant MANTIS"</span>, <span class="seriesInfo">CRYPTO 2016</span>, <time datetime="2016" class="refDate">2016</time>, <span>&lt;<a href="https://eprint.iacr.org/2016/660">https://eprint.iacr.org/2016/660</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="XTS-AES">[XTS-AES]</dt>
      <dd>
<span class="refAuthor">Black, J.</span>, <span class="refAuthor">Dawson, E.</span>, <span class="refAuthor">Gueron, S.</span>, and <span class="refAuthor">P. Rogaway</span>, <span class="refTitle">"The XTS-AES Mode for Disk Encryption"</span>, <span class="seriesInfo">IEEE 1619-2007</span>, <time datetime="2010" class="refDate">2010</time>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="diagrams">
<section id="appendix-A">
      <h2 id="name-diagrams">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-diagrams" class="section-name selfRef">Diagrams</a>
      </h2>
<p id="appendix-A-1">This appendix provides visual representations of the key operations described in this document. For implementation details, see <a href="#pseudocode-and-examples" class="auto internal xref">Appendix B</a>.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<div id="ipv4-address-conversion-diagram">
<section id="appendix-A.1">
        <h3 id="name-ipv4-address-conversion-dia">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-ipv4-address-conversion-dia" class="section-name selfRef">IPv4 Address Conversion Diagram</a>
        </h3>
<div class="alignLeft art-text artwork" id="appendix-A.1-1">
<pre>
       IPv4: 192.0.2.1
           |
           v
  Octets:  C0  00  02  01
           |
           v
   16-Byte Array:
[00 00 00 00 00 00 00 00 00 00 | FF FF | C0 00 02 01]
</pre><a href="#appendix-A.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="deterministic-encryption-flow">
<section id="appendix-A.2">
        <h3 id="name-deterministic-encryption-fl">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-deterministic-encryption-fl" class="section-name selfRef">Deterministic Encryption Flow</a>
        </h3>
<div class="alignLeft art-text artwork" id="appendix-A.2-1">
<pre>
            IP Address
                |
                v
       [Convert to 16 Bytes]
                |
                v
    [AES-128 Single-Block Encrypt]
                |
                v
       16-Byte Ciphertext
                |
                v
     [Convert to IP Format]
                |
                v
       Encrypted IP Address
</pre><a href="#appendix-A.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="nondeterministic-encryption-flow-ipcrypt-nd">
<section id="appendix-A.3">
        <h3 id="name-nondeterministic-encryption">
<a href="#appendix-A.3" class="section-number selfRef">A.3. </a><a href="#name-nondeterministic-encryption" class="section-name selfRef">Non‑Deterministic Encryption Flow (ipcrypt-nd)</a>
        </h3>
<div class="alignLeft art-text artwork" id="appendix-A.3-1">
<pre>
              IP Address
                  |
                  v
       [Convert to 16 Bytes]
                  |
                  v
    [Generate Random 8-Byte Tweak]
                  |
                  v
       [KIASU-BC Tweakable Encrypt]
                  |
                  v
          16-Byte Ciphertext
                  |
                  v
    [Concatenate Tweak || Ciphertext]
                  |
                  v
       24-Byte Output (ipcrypt-nd)
</pre><a href="#appendix-A.3-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="nondeterministic-encryption-flow-ipcrypt-ndx">
<section id="appendix-A.4">
        <h3 id="name-nondeterministic-encryption-">
<a href="#appendix-A.4" class="section-number selfRef">A.4. </a><a href="#name-nondeterministic-encryption-" class="section-name selfRef">Non‑Deterministic Encryption Flow (ipcrypt-ndx)</a>
        </h3>
<div class="alignLeft art-text artwork" id="appendix-A.4-1">
<pre>
              IP Address
                  |
                  v
       [Convert to 16 Bytes]
                  |
                  v
    [Generate Random 16-Byte Tweak]
                  |
                  v
       [AES-XTS Tweakable Encrypt]
                  |
                  v
          16-Byte Ciphertext
                  |
                  v
    [Concatenate Tweak || Ciphertext]
                  |
                  v
       32-Byte Output (ipcrypt-ndx)
</pre><a href="#appendix-A.4-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="pseudocode-and-examples">
<section id="appendix-B">
      <h2 id="name-pseudocode-and-examples">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-pseudocode-and-examples" class="section-name selfRef">Pseudocode and Examples</a>
      </h2>
<p id="appendix-B-1">This appendix provides detailed pseudocode for key operations described in this document. For a visual representation of these operations, see <a href="#diagrams" class="auto internal xref">Appendix A</a>.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<div id="ipv4-address-conversion">
<section id="appendix-B.1">
        <h3 id="name-ipv4-address-conversion">
<a href="#appendix-B.1" class="section-number selfRef">B.1. </a><a href="#name-ipv4-address-conversion" class="section-name selfRef">IPv4 Address Conversion</a>
        </h3>
<p id="appendix-B.1-1">For a diagram of this conversion process, see <a href="#ipv4-address-conversion-diagram" class="auto internal xref">Appendix A.1</a>.<a href="#appendix-B.1-1" class="pilcrow">¶</a></p>
<div class="lang-pseudocode sourcecode" id="appendix-B.1-2">
<pre>
function IPv4To16Bytes(ipv4_address):
    // Split the IPv4 address into its octets
    parts = ipv4_address.split(".")
    if length(parts) != 4:
         raise Error("Invalid IPv4 address")
    // Create a 16-byte array with the IPv4-mapped prefix
    bytes16 = [0x00] * 10         // 10 bytes of 0x00
    bytes16.append(0xFF)          // 11th byte: 0xFF
    bytes16.append(0xFF)          // 12th byte: 0xFF
    // Append each octet (converted to an 8-bit integer)
    for part in parts:
         bytes16.append(int(part))
    return bytes16
</pre><a href="#appendix-B.1-2" class="pilcrow">¶</a>
</div>
<p id="appendix-B.1-3"><em>Example:</em> For <code>"192.0.2.1"</code>, the function returns<a href="#appendix-B.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-B.1-4">
<pre>
[00, 00, 00, 00, 00, 00, 00, 00, 00, 00, FF, FF, C0, 00, 02, 01]
</pre><a href="#appendix-B.1-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="ipv6-address-conversion">
<section id="appendix-B.2">
        <h3 id="name-ipv6-address-conversion">
<a href="#appendix-B.2" class="section-number selfRef">B.2. </a><a href="#name-ipv6-address-conversion" class="section-name selfRef">IPv6 Address Conversion</a>
        </h3>
<div class="lang-pseudocode sourcecode" id="appendix-B.2-1">
<pre>
function IPv6To16Bytes(ipv6_address):
    // Parse the IPv6 address into eight 16-bit words.
    words = parseIPv6(ipv6_address)  // Expands shorthand notation and returns 8 words
    bytes16 = []
    for word in words:
         high_byte = (word &gt;&gt; 8) &amp; 0xFF
         low_byte = word &amp; 0xFF
         bytes16.append(high_byte)
         bytes16.append(low_byte)
    return bytes16
</pre><a href="#appendix-B.2-1" class="pilcrow">¶</a>
</div>
<p id="appendix-B.2-2"><em>Example:</em> For <code>"2001:0db8:85a3:0000:0000:8a2e:0370:7334"</code>, the output is the corresponding 16‑byte sequence.<a href="#appendix-B.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conversion-from-a-16-byte-array-to-an-ip-address">
<section id="appendix-B.3">
        <h3 id="name-conversion-from-a-16-byte-a">
<a href="#appendix-B.3" class="section-number selfRef">B.3. </a><a href="#name-conversion-from-a-16-byte-a" class="section-name selfRef">Conversion from a 16-Byte Array to an IP Address</a>
        </h3>
<div class="lang-pseudocode sourcecode" id="appendix-B.3-1">
<pre>
function Bytes16ToIP(bytes16):
    if length(bytes16) != 16:
         raise Error("Invalid byte array")

    // Check for the IPv4-mapped prefix
    if bytes16[0:10] == [0x00]*10 and bytes16[10] == 0xFF and bytes16[11] == 0xFF:
         ipv4_parts = []
         for i from 12 to 15:
             ipv4_parts.append(str(bytes16[i]))
         ipv4_address = join(ipv4_parts, ".")
         return ipv4_address
    else:
         words = []
         for i from 0 to 15 step 2:
             word = (bytes16[i] &lt;&lt; 8) | bytes16[i+1]
             words.append(format(word, "x"))
         ipv6_address = join(words, ":")
         return ipv6_address
</pre><a href="#appendix-B.3-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="deterministic-encryption-ipcrypt-deterministic">
<section id="appendix-B.4">
        <h3 id="name-deterministic-encryption-ip">
<a href="#appendix-B.4" class="section-number selfRef">B.4. </a><a href="#name-deterministic-encryption-ip" class="section-name selfRef">Deterministic Encryption (ipcrypt-deterministic)</a>
        </h3>
<div class="lang-pseudocode sourcecode" id="appendix-B.4-1">
<pre>
function ipcrypt_deterministic_encrypt(ip_address, key):
    // The key MUST be exactly 16 bytes (128 bits) in length
    if length(key) != 16:
        raise Error("Key must be 16 bytes")

    bytes16 = convertTo16Bytes(ip_address)
    ciphertext = AES128_encrypt(key, bytes16)
    encrypted_ip = Bytes16ToIP(ciphertext)
    return encrypted_ip

function ipcrypt_deterministic_decrypt(encrypted_ip, key):
    if length(key) != 16:
        raise Error("Key must be 16 bytes")

    bytes16 = convertTo16Bytes(encrypted_ip)
    plaintext = AES128_decrypt(key, bytes16)
    original_ip = Bytes16ToIP(plaintext)
    return original_ip
</pre><a href="#appendix-B.4-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="non-deterministic-encryption-using-kiasu-bc-ipcrypt-nd">
<section id="appendix-B.5">
        <h3 id="name-non-deterministic-encryption">
<a href="#appendix-B.5" class="section-number selfRef">B.5. </a><a href="#name-non-deterministic-encryption" class="section-name selfRef">Non-Deterministic Encryption using KIASU-BC (ipcrypt-nd)</a>
        </h3>
<div class="lang-pseudocode sourcecode" id="appendix-B.5-1">
<pre>
function ipcrypt_nd_encrypt(ip_address, key):
    if length(key) != 16:
        raise Error("Key must be 16 bytes")

    // Step 1: Generate random tweak (8 bytes)
    tweak = random_bytes(8)  // MUST be uniformly random

    // Step 2: Convert IP to 16-byte representation
    bytes16 = convertTo16Bytes(ip_address)

    // Step 3: Encrypt using key and tweak
    ciphertext = KIASU_BC_encrypt(key, tweak, bytes16)

    // Step 4: Concatenate tweak and ciphertext
    result = concatenate(tweak, ciphertext)  // 8 bytes || 16 bytes = 24 bytes total
    return result

function ipcrypt_nd_decrypt(ciphertext, key):
    // Step 1: Split ciphertext into tweak and encrypted IP
    tweak = ciphertext[0:8]  // First 8 bytes
    encrypted_ip = ciphertext[8:24]  // Remaining 16 bytes

    // Step 2: Decrypt using key and tweak
    bytes16 = KIASU_BC_decrypt(key, tweak, encrypted_ip)

    // Step 3: Convert back to IP address
    ip_address = Bytes16ToIP(bytes16)
    return ip_address
</pre><a href="#appendix-B.5-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="non-deterministic-encryption-using-aes-xts-ipcrypt-ndx">
<section id="appendix-B.6">
        <h3 id="name-non-deterministic-encryption-">
<a href="#appendix-B.6" class="section-number selfRef">B.6. </a><a href="#name-non-deterministic-encryption-" class="section-name selfRef">Non-Deterministic Encryption using AES-XTS (ipcrypt-ndx)</a>
        </h3>
<div class="lang-pseudocode sourcecode" id="appendix-B.6-1">
<pre>
function AES_XTS_encrypt(key, tweak, block):
    // Split the key into two halves
    K1, K2 = split_key(key)

    // Encrypt the tweak with the second half of the key
    ET = AES128_encrypt(K2, tweak)

    // Encrypt the block: AES128(block ⊕ ET, K1) ⊕ ET
    return AES128_encrypt(K1, block ⊕ ET) ⊕ ET
</pre><a href="#appendix-B.6-1" class="pilcrow">¶</a>
</div>
<div class="lang-pseudocode sourcecode" id="appendix-B.6-2">
<pre>
function ipcrypt_ndx_encrypt(ip_address, key):
    if length(key) != 32:
        raise Error("Key must be 32 bytes (two AES-128 keys)")

    // Step 1: Generate random tweak (16 bytes)
    tweak = random_bytes(16)  // MUST be uniformly random

    // Step 2: Convert IP to 16-byte representation
    bytes16 = convertTo16Bytes(ip_address)

    // Step 3: Encrypt using key and tweak
    ciphertext = AES_XTS_encrypt(key, tweak, bytes16)

    // Step 4: Concatenate tweak and ciphertext
    result = concatenate(tweak, ciphertext)  // 16 bytes || 16 bytes = 32 bytes total
    return result

function ipcrypt_ndx_decrypt(ciphertext, key):
    // Step 1: Split ciphertext into tweak and encrypted IP
    tweak = ciphertext[0:16]  // First 16 bytes
    encrypted_ip = ciphertext[16:32]  // Remaining 16 bytes

    // Step 2: Decrypt using key and tweak
    bytes16 = AES_XTS_decrypt(key, tweak, encrypted_ip)

    // Step 3: Convert back to IP address
    ip_address = Bytes16ToIP(bytes16)
    return ip_address
</pre><a href="#appendix-B.6-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="implementing-kiasu-bc">
<section id="appendix-C">
      <h2 id="name-implementing-kiasu-bc">
<a href="#appendix-C" class="section-number selfRef">Appendix C. </a><a href="#name-implementing-kiasu-bc" class="section-name selfRef">Implementing KIASU-BC</a>
      </h2>
<p id="appendix-C-1">This appendix provides a detailed guide for implementing the KIASU-BC tweakable block cipher. KIASU-BC is based on AES-128 with modifications to incorporate a tweak.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
<div id="overview">
<section id="appendix-C.1">
        <h3 id="name-overview">
<a href="#appendix-C.1" class="section-number selfRef">C.1. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
        </h3>
<p id="appendix-C.1-1">KIASU-BC extends AES-128 by incorporating an 8-byte tweak into each round. The tweak is padded to 16 bytes and XORed with the round key at each round of the cipher. This construction is used in the <code>ipcrypt-nd</code> instantiation.<a href="#appendix-C.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="tweak-padding">
<section id="appendix-C.2">
        <h3 id="name-tweak-padding">
<a href="#appendix-C.2" class="section-number selfRef">C.2. </a><a href="#name-tweak-padding" class="section-name selfRef">Tweak Padding</a>
        </h3>
<p id="appendix-C.2-1">The 8-byte tweak is padded to 16 bytes using the following method:<a href="#appendix-C.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="appendix-C.2-2">
<li id="appendix-C.2-2.1">
            <p id="appendix-C.2-2.1.1">Split the 8-byte tweak into four 2-byte pairs<a href="#appendix-C.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-C.2-2.2">
            <p id="appendix-C.2-2.2.1">Place each 2-byte pair at the start of each 4-byte group<a href="#appendix-C.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-C.2-2.3">
            <p id="appendix-C.2-2.3.1">Fill the remaining 2 bytes of each group with zeros<a href="#appendix-C.2-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="appendix-C.2-3">Example:<a href="#appendix-C.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-C.2-4">
<pre>
8-byte tweak:    [T0 T1 T2 T3 T4 T5 T6 T7]
16-byte padded:  [T0 T1 00 00 T2 T3 00 00 T4 T5 00 00 T6 T7 00 00]
</pre><a href="#appendix-C.2-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="round-structure">
<section id="appendix-C.3">
        <h3 id="name-round-structure">
<a href="#appendix-C.3" class="section-number selfRef">C.3. </a><a href="#name-round-structure" class="section-name selfRef">Round Structure</a>
        </h3>
<p id="appendix-C.3-1">Each round of KIASU-BC consists of the following standard AES operations:<a href="#appendix-C.3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="appendix-C.3-2">
<li id="appendix-C.3-2.1">
            <p id="appendix-C.3-2.1.1"><strong>SubBytes:</strong> Apply the AES S-box to each byte of the state<a href="#appendix-C.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-C.3-2.2">
            <p id="appendix-C.3-2.2.1"><strong>ShiftRows:</strong> Rotate each row of the state matrix<a href="#appendix-C.3-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-C.3-2.3">
            <p id="appendix-C.3-2.3.1"><strong>MixColumns:</strong> Mix the columns of the state matrix (except in the final round)<a href="#appendix-C.3-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-C.3-2.4">
            <p id="appendix-C.3-2.4.1"><strong>AddRoundKey:</strong> XOR the state with the round key and padded tweak<a href="#appendix-C.3-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="appendix-C.3-3">For details about these operations, see <span>[<a href="#FIPS-197" class="cite xref">FIPS-197</a>]</span>.<a href="#appendix-C.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="key-schedule">
<section id="appendix-C.4">
        <h3 id="name-key-schedule">
<a href="#appendix-C.4" class="section-number selfRef">C.4. </a><a href="#name-key-schedule" class="section-name selfRef">Key Schedule</a>
        </h3>
<p id="appendix-C.4-1">The key schedule follows the standard AES-128 key expansion:<a href="#appendix-C.4-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="appendix-C.4-2">
<li id="appendix-C.4-2.1">
            <p id="appendix-C.4-2.1.1">The initial key is expanded into 11 round keys<a href="#appendix-C.4-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-C.4-2.2">
            <p id="appendix-C.4-2.2.1">Each round key is XORed with the padded tweak before use<a href="#appendix-C.4-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-C.4-2.3">
            <p id="appendix-C.4-2.3.1">The first round key is used in the initial AddRoundKey operation<a href="#appendix-C.4-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ol>
</section>
</div>
<div id="implementation-steps">
<section id="appendix-C.5">
        <h3 id="name-implementation-steps">
<a href="#appendix-C.5" class="section-number selfRef">C.5. </a><a href="#name-implementation-steps" class="section-name selfRef">Implementation Steps</a>
        </h3>
<ol start="1" type="1" class="normal type-1" id="appendix-C.5-1">
<li id="appendix-C.5-1.1">
            <p id="appendix-C.5-1.1.1"><strong>Key Expansion:</strong><a href="#appendix-C.5-1.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.5-1.1.2.1">
                <p id="appendix-C.5-1.1.2.1.1">Expand the 16-byte key into 11 round keys using the standard AES key schedule<a href="#appendix-C.5-1.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-C.5-1.1.2.2">
                <p id="appendix-C.5-1.1.2.2.1">Each round key is 16 bytes<a href="#appendix-C.5-1.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li id="appendix-C.5-1.2">
            <p id="appendix-C.5-1.2.1"><strong>Tweak Processing:</strong><a href="#appendix-C.5-1.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.5-1.2.2.1">
                <p id="appendix-C.5-1.2.2.1.1">Pad the 8-byte tweak to 16 bytes as described above<a href="#appendix-C.5-1.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-C.5-1.2.2.2">
                <p id="appendix-C.5-1.2.2.2.1">XOR the padded tweak with each round key before use<a href="#appendix-C.5-1.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li id="appendix-C.5-1.3">
            <p id="appendix-C.5-1.3.1"><strong>Encryption Process:</strong><a href="#appendix-C.5-1.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.5-1.3.2.1">
                <p id="appendix-C.5-1.3.2.1.1">Perform initial AddRoundKey with the first tweaked round key<a href="#appendix-C.5-1.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-C.5-1.3.2.2">
                <p id="appendix-C.5-1.3.2.2.1">For rounds 1-9:<a href="#appendix-C.5-1.3.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.5-1.3.2.2.2.1">
                    <p id="appendix-C.5-1.3.2.2.2.1.1">SubBytes<a href="#appendix-C.5-1.3.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="appendix-C.5-1.3.2.2.2.2">
                    <p id="appendix-C.5-1.3.2.2.2.2.1">ShiftRows<a href="#appendix-C.5-1.3.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="appendix-C.5-1.3.2.2.2.3">
                    <p id="appendix-C.5-1.3.2.2.2.3.1">MixColumns<a href="#appendix-C.5-1.3.2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="appendix-C.5-1.3.2.2.2.4">
                    <p id="appendix-C.5-1.3.2.2.2.4.1">AddRoundKey (with tweaked round key)<a href="#appendix-C.5-1.3.2.2.2.4.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="normal" id="appendix-C.5-1.3.2.3">
                <p id="appendix-C.5-1.3.2.3.1">For round 10 (final round):<a href="#appendix-C.5-1.3.2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.5-1.3.2.3.2.1">
                    <p id="appendix-C.5-1.3.2.3.2.1.1">SubBytes<a href="#appendix-C.5-1.3.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="appendix-C.5-1.3.2.3.2.2">
                    <p id="appendix-C.5-1.3.2.3.2.2.1">ShiftRows<a href="#appendix-C.5-1.3.2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="appendix-C.5-1.3.2.3.2.3">
                    <p id="appendix-C.5-1.3.2.3.2.3.1">AddRoundKey (with tweaked round key)<a href="#appendix-C.5-1.3.2.3.2.3.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
        </ol>
</section>
</div>
<div id="example-implementation">
<section id="appendix-C.6">
        <h3 id="name-example-implementation">
<a href="#appendix-C.6" class="section-number selfRef">C.6. </a><a href="#name-example-implementation" class="section-name selfRef">Example Implementation</a>
        </h3>
<p id="appendix-C.6-1">The following pseudocode illustrates the core operations of KIASU-BC:<a href="#appendix-C.6-1" class="pilcrow">¶</a></p>
<div class="lang-pseudocode sourcecode" id="appendix-C.6-2">
<pre>
function pad_tweak(tweak):
    // Input: 8-byte tweak
    // Output: 16-byte padded tweak
    padded = [0] * 16
    for i in range(0, 8, 2):
        padded[i*2] = tweak[i]
        padded[i*2+1] = tweak[i+1]
    return padded

function kiasu_bc_encrypt(key, tweak, plaintext):
    // Input: 16-byte key, 8-byte tweak, 16-byte plaintext
    // Output: 16-byte ciphertext

    // Expand key and pad tweak
    round_keys = expand_key(key)
    padded_tweak = pad_tweak(tweak)

    // Initial round
    state = plaintext
    state = add_round_key(state, round_keys[0] ^ padded_tweak)

    // Main rounds
    for round in range(1, 10):
        state = sub_bytes(state)
        state = shift_rows(state)
        state = mix_columns(state)
        state = add_round_key(state, round_keys[round] ^ padded_tweak)

    // Final round
    state = sub_bytes(state)
    state = shift_rows(state)
    state = add_round_key(state, round_keys[10] ^ padded_tweak)

    return state
</pre><a href="#appendix-C.6-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="test-vectors">
<section id="appendix-D">
      <h2 id="name-test-vectors">
<a href="#appendix-D" class="section-number selfRef">Appendix D. </a><a href="#name-test-vectors" class="section-name selfRef">Test Vectors</a>
      </h2>
<p id="appendix-D-1">This appendix provides test vectors for all three variants of ipcrypt. Each test vector includes the key, input IP address, and encrypted output. For non-deterministic variants (<code>ipcrypt-nd</code> and <code>ipcrypt-ndx</code>), the tweak value is also included.<a href="#appendix-D-1" class="pilcrow">¶</a></p>
<p id="appendix-D-2">Key and tweak sizes for each variant:
- <code>ipcrypt-deterministic</code>: Key: 16 bytes (128 bits), no tweak
- <code>ipcrypt-nd</code>: Key: 16 bytes (128 bits), Tweak: 8 bytes (64 bits)
- <code>ipcrypt-ndx</code>: Key: 32 bytes (256 bits, two AES-128 keys), Tweak: 16 bytes (128 bits)<a href="#appendix-D-2" class="pilcrow">¶</a></p>
<div id="ipcrypt-deterministic-test-vectors">
<section id="appendix-D.1">
        <h3 id="name-ipcrypt-deterministic-test-">
<a href="#appendix-D.1" class="section-number selfRef">D.1. </a><a href="#name-ipcrypt-deterministic-test-" class="section-name selfRef">ipcrypt-deterministic Test Vectors</a>
        </h3>
<div class="alignLeft art-text artwork" id="appendix-D.1-1">
<pre>
# Test vector 1
Key:          0123456789abcdeffedcba9876543210
Input IP:     0.0.0.0
Encrypted IP: bde9:6789:d353:824c:d7c6:f58a:6bd2:26eb

# Test vector 2
Key:          1032547698badcfeefcdab8967452301
Input IP:     255.255.255.255
Encrypted IP: aed2:92f6:ea23:58c3:48fd:8b8:74e8:45d8

# Test vector 3
Key:          2b7e151628aed2a6abf7158809cf4f3c
Input IP:     192.0.2.1
Encrypted IP: 1dbd:c1b9:fff1:7586:7d0b:67b4:e76e:4777
</pre><a href="#appendix-D.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="ipcrypt-nd-test-vectors">
<section id="appendix-D.2">
        <h3 id="name-ipcrypt-nd-test-vectors">
<a href="#appendix-D.2" class="section-number selfRef">D.2. </a><a href="#name-ipcrypt-nd-test-vectors" class="section-name selfRef">ipcrypt-nd Test Vectors</a>
        </h3>
<div class="alignLeft art-text artwork" id="appendix-D.2-1">
<pre>
# Test vector 1
Key:          0123456789abcdeffedcba9876543210
Input IP:     0.0.0.0
Tweak:        08e0c289bff23b7c
Output:       08e0c289bff23b7cb349aadfe3bcef56221c384c7c217b16

# Test vector 2
Key:          1032547698badcfeefcdab8967452301
Input IP:     192.0.2.1
Tweak:        21bd1834bc088cd2
Output:       21bd1834bc088cd2e5e1fe55f95876e639faae2594a0caad

# Test vector 3
Key:          2b7e151628aed2a6abf7158809cf4f3c
Input IP:     2001:db8::1
Tweak:        b4ecbe30b70898d7
Output:       b4ecbe30b70898d7553ac8974d1b4250eafc4b0aa1f80c96
</pre><a href="#appendix-D.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="ipcrypt-ndx-test-vectors">
<section id="appendix-D.3">
        <h3 id="name-ipcrypt-ndx-test-vectors">
<a href="#appendix-D.3" class="section-number selfRef">D.3. </a><a href="#name-ipcrypt-ndx-test-vectors" class="section-name selfRef">ipcrypt-ndx Test Vectors</a>
        </h3>
<div class="alignLeft art-text artwork" id="appendix-D.3-1">
<pre>
# Test vector 1
Key:          0123456789abcdeffedcba98765432101032547698badcfeefcdab8967452301
Input IP:     0.0.0.0
Tweak:        21bd1834bc088cd2b4ecbe30b70898d7
Output:       21bd1834bc088cd2b4ecbe30b70898d782db0d4125fdace61db35b8339f20ee5

# Test vector 2
Key:          1032547698badcfeefcdab89674523010123456789abcdeffedcba9876543210
Input IP:     192.0.2.1
Tweak:        08e0c289bff23b7cb4ecbe30b70898d7
Output:       08e0c289bff23b7cb4ecbe30b70898d7766a533392a69edf1ad0d3ce362ba98a

# Test vector 3
Key:          2b7e151628aed2a6abf7158809cf4f3c3c4fcf098815f7aba6d2ae2816157e2b
Input IP:     2001:db8::1
Tweak:        21bd1834bc088cd2b4ecbe30b70898d7
Output:       21bd1834bc088cd2b4ecbe30b70898d76089c7e05ae30c2d10ca149870a263e4
</pre><a href="#appendix-D.3-1" class="pilcrow">¶</a>
</div>
<p id="appendix-D.3-2">For non-deterministic variants (<code>ipcrypt-nd</code> and <code>ipcrypt-ndx</code>), the tweak values shown are examples. In practice, tweaks MUST be randomly generated for each encryption operation.<a href="#appendix-D.3-2" class="pilcrow">¶</a></p>
<p id="appendix-D.3-3">Implementations SHOULD verify their correctness against these test vectors before deployment.<a href="#appendix-D.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="alternatives-to-random-tweaks">
<section id="appendix-E">
      <h2 id="name-alternatives-to-random-twea">
<a href="#appendix-E" class="section-number selfRef">Appendix E. </a><a href="#name-alternatives-to-random-twea" class="section-name selfRef">Alternatives to Random Tweaks</a>
      </h2>
<p id="appendix-E-1">While this specification recommends the use of uniformly random tweaks for non-deterministic encryption, implementers may consider alternative approaches:<a href="#appendix-E-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-E-2.1">
          <p id="appendix-E-2.1.1"><strong>Monotonic Counter:</strong> A counter could be used as a tweak, but this is difficult to maintain in distributed systems. If the counter is not encrypted and the tweakable block cipher is not secure against related-tweak attacks, this could enable correlation attacks.<a href="#appendix-E-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-E-2.2">
          <p id="appendix-E-2.2.1"><strong>UUIDs:</strong> UUIDs (such as UUIDv6 or UUIDv7) could be used as tweaks; however, these would reveal the original timestamp of the logged IP addresses, which may not be desirable from a privacy perspective.<a href="#appendix-E-2.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-E-3">Although the birthday bound is a concern with random tweaks, the use of random tweaks remains the recommended and most practical approach, offering the best tradeoffs for most real-world use cases.<a href="#appendix-E-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-F">
      <h2 id="name-acknowledgments">
<a href="#appendix-F" class="section-number selfRef">Appendix F. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-F-1">The author gratefully acknowledges the contributions and insightful comments from members of the IETF independent stream community and the broader cryptographic community that have helped shape this specification.<a href="#appendix-F-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-G">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Frank Denis</span></div>
<div dir="auto" class="left"><span class="org">Fastly Inc.</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:fde@00f.net" class="email">fde@00f.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
